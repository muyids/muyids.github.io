(window.webpackJsonp=window.webpackJsonp||[]).push([[200],{474:function(a,r,e){"use strict";e.r(r);var o=e(14),t=Object(o.a)({},(function(){var a=this,r=a._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[r("h2",{attrs:{id:"推荐配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#推荐配置"}},[a._v("#")]),a._v(" 推荐配置")]),a._v(" "),r("p",[r("strong",[a._v("分区数")])]),a._v(" "),r("p",[a._v("partitions = 16")]),a._v(" "),r("p",[r("strong",[a._v("副本")])]),a._v(" "),r("p",[a._v("rc.factor = 2")]),a._v(" "),r("p",[r("strong",[a._v("log.dirs")])]),a._v(" "),r("p",[a._v("log.dirs 建议配置多目录")]),a._v(" "),r("p",[a._v("原因：kafka 的吞吐量 与 数据写入磁盘的效率 有很大关系，可以通过数据文件的多目录配置，提高吞吐")]),a._v(" "),r("p",[r("strong",[a._v("指标及其含义")])]),a._v(" "),r("p",[r("strong",[a._v("Brokers Spread")])]),a._v(" "),r("p",[a._v("看作 broker 使用率，如 kafka 集群 9 个 broker，某 topic 有 7 个 partition，则 "),r("code",[a._v("broker spread: 7 / 9 = 77%")])]),a._v(" "),r("p",[r("strong",[a._v("Brokers Skew")])]),a._v(" "),r("p",[a._v("partition 是否存在倾斜，如 kafka 集群 9 个 broker，某 topic 有 18 个 partition，正常每个 broker 应该 2 个 partition。若其中有 3 个 broker 上的 partition 数>2，则"),r("code",[a._v("broker skew: 3 / 9 = 33%")])]),a._v(" "),r("p",[r("strong",[a._v("Brokers Leader Skew")])]),a._v(" "),r("p",[a._v("leader partition 是否存在倾斜，如 kafka 集群 9 个 broker，某 topic14 个 partition，则正常每个 broker 有 2 个 leader partition。若其中一个 broker 有 0 个 leader partition，一个有 4 个 leader partition，则"),r("code",[a._v("broker leader skew: (4 - 2) / 14 = 14%")])]),a._v(" "),r("p",[a._v("由于 kafka 所有读写都在 leader 上进行， "),r("code",[a._v("broker leader skew")]),a._v("会导致不同 broker 的读写负载不均衡，配置参数 "),r("code",[a._v("auto.leader.rebalance.enable=true")]),a._v(" 可以使 kafka 每 5min 自动做一次 leader 的"),r("code",[a._v("rebalance")]),a._v("，消除这个问题。")]),a._v(" "),r("p",[r("strong",[a._v("Lag")])]),a._v(" "),r("p",[a._v("Lag 代表 consumer 的消费能力")]),a._v(" "),r("p",[r("strong",[a._v("为什么 Lag 有时是负数？")])]),a._v(" "),r("p",[a._v("Lag 的计算公式为"),r("code",[a._v("Lag = Consumer Offset - LogSize")]),a._v("，Kafka Manager 先从 zk 获取 LogSize，再从"),r("code",[a._v("kafka __consumer_offsets topic")]),a._v("读取 Offset。两步操作存在一个时间 gap，因此吞吐很大的 topic 上会出现"),r("code",[a._v("Offset > LogSize")]),a._v("的情况。导致 Lag 负数")]),a._v(" "),r("h3",{attrs:{id:"运维监控方案对比"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#运维监控方案对比"}},[a._v("#")]),a._v(" 运维监控方案对比")]),a._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"#kafka-manager"}},[a._v("Kafka Manager")])]),a._v(" "),r("li",[r("a",{attrs:{href:"#KafkaOffsetMonitor"}},[a._v("KafkaOffsetMonitor")])]),a._v(" "),r("li",[r("a",{attrs:{href:"#JMXtrans+InfluxDB+Grafana"}},[a._v("JMXtrans+InfluxDB+Grafana")])])]),a._v(" "),r("p",[r("strong",[a._v("kafka-manager")])]),a._v(" "),r("p",[a._v("Git 地址：")]),a._v(" "),r("ul",[r("li",[a._v("当前地址：https://github.com/yahoo/CMAK")]),a._v(" "),r("li",[a._v("老版本地址（0.10.0 之前版本）：https://github.com/yahoo/kafka-manager\n修改配置文件：conf/application.conf")])]),a._v(" "),r("p",[r("code",[a._v('kafka-manager.zkhosts="localhost:2181"')])]),a._v(" "),r("p",[a._v("启动")]),a._v(" "),r("p",[r("code",[a._v("./bin/kafka-manager -Dconfig.file=conf/application.conf -Dhttp.port=9001 ##默认")])]),a._v(" "),r("p",[r("strong",[a._v("JMX 端口开启")])]),a._v(" "),r("p",[a._v("在启动 kafka 之前，修改环境变量"),r("code",[a._v("JMX_PORT")])]),a._v(" "),r("p",[a._v("或者启动 kafka 时传入参数")]),a._v(" "),r("p",[r("code",[a._v("JMX_PORT=9999 /app/kafka_2.12-2.5.0/bin/kafka-server-start.sh -daemon /app/kafka_2.12-2.5.0/config/server.properties")])]),a._v(" "),r("p",[r("strong",[a._v("KafkaOffsetMonitor")])])])}),[],!1,null,null,null);r.default=t.exports}}]);