(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{459:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"为什么用-node-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么用-node-js"}},[t._v("#")]),t._v(" 为什么用 Node.js")]),t._v(" "),s("ul",[s("li",[t._v("简单强大，轻量可扩展")]),t._v(" "),s("li",[t._v("javascript,json 来进行编码,web 开发必备技能")]),t._v(" "),s("li",[t._v("非阻塞 IO,可以适应分块传输数据，较慢的网络环境，尤其擅长高并发访问")]),t._v(" "),s("li",[t._v("前后端使用统一语言")]),t._v(" "),s("li",[t._v("可扩展体现在可以轻松应对"),s("strong",[t._v("多实例，多服务器架构")]),t._v("，同时有海量的第三方应用组件")])]),t._v(" "),s("h2",{attrs:{id:"事件循环和非阻塞-io"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事件循环和非阻塞-io"}},[t._v("#")]),t._v(" 事件循环和非阻塞 IO")]),t._v(" "),s("h3",{attrs:{id:"单线程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单线程"}},[t._v("#")]),t._v(" 单线程")]),t._v(" "),s("ul",[s("li",[t._v("传统 web 服务中，大多都是使用多线程机制来解决并发的问题，原因是 I/O 事件会阻塞线程，而阻塞就意味着要等待")]),t._v(" "),s("li",[t._v("node 的设计是采用了单线程的机制，只是针对 主线程来说，即每个 node 进程只有一个主线程来执行程序代码")]),t._v(" "),s("li",[t._v("采用了"),s("strong",[t._v("事件驱动")]),t._v("的机制，将耗时阻塞的 I/O 操作交给线程池中的某个线程去完成")]),t._v(" "),s("li",[t._v("主线程本身只负责不断地调度，并没有执行真正的 I/O 操作。也就是说 node 实现的是异步非阻塞式。\n底层，Node.js 借助 libuv 来作为抽象封装层，从而屏蔽不同操作系统的差异")])]),t._v(" "),s("p",[t._v("libuv: linux 下用 libev 实现，Windows 下用 IOCP 实现")]),t._v(" "),s("p",[s("strong",[t._v("IO 多路复用模型")])]),t._v(" "),s("h3",{attrs:{id:"事件循环机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事件循环机制"}},[t._v("#")]),t._v(" 事件循环机制")]),t._v(" "),s("p",[t._v("根据 node 的官方介绍，node 每次事件循环机制都包含了 6 个阶段：")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("timers 阶段")]),t._v("：这个阶段执行已经到期的 timer(setTimeout、setInterval)回调")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("I/O callbacks 阶段")]),t._v("：执行 I/O（例如文件、网络）的回调")])]),t._v(" "),s("li",[s("p",[t._v("idle, prepare 阶段：node 内部使用")])]),t._v(" "),s("li",[s("p",[t._v("poll 阶段：获取新的 I/O 事件, 适当的条件下 node 将阻塞在这里")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("check 阶段")]),t._v("：执行 setImmediate 回调")])]),t._v(" "),s("li",[s("p",[t._v("close callbacks 阶段：执行 close 事件回调，比如 TCP 断开连接\n对于日常开发来说，我们比较关注的是"),s("code",[t._v("timers、I/O callbacks、check阶段")])])]),t._v(" "),s("li",[s("p",[t._v("node 和浏览器相比一个明显的不同就是 node 在"),s("strong",[t._v("每个阶段结束后会去执行所有 process.nextTick 、microtask（promise）任务")])])])]),t._v(" "),s("p",[t._v("事件循环原理")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("node 的初始化")]),t._v(" "),s("ul",[s("li",[t._v("初始化 node 环境。")]),t._v(" "),s("li",[t._v("执行输入代码。")]),t._v(" "),s("li",[t._v("执行 process.nextTick 回调。")]),t._v(" "),s("li",[t._v("执行 microtasks。")])])]),t._v(" "),s("li",[s("p",[t._v("进入 event-loop")]),t._v(" "),s("ul",[s("li",[t._v("进入 timers 阶段\n"),s("ul",[s("li",[t._v("检查 timer 队列是否有到期的 timer 回调，如果有，将到期的 timer 回调按照 timerId 升序执行。")]),t._v(" "),s("li",[t._v("检查是否有 process.nextTick 任务，如果有，全部执行。")]),t._v(" "),s("li",[t._v("检查是否有 microtask，如果有，全部执行。")]),t._v(" "),s("li",[t._v("退出该阶段。")])])]),t._v(" "),s("li",[t._v("进入 IO callbacks 阶段\n"),s("ul",[s("li",[t._v("检查是否有 pending 的 I/O 回调。如果有，执行回调。如果没有，退出该阶段")]),t._v(" "),s("li",[t._v("检查是否有 process.nextTick 任务，如果有，全部执行")]),t._v(" "),s("li",[t._v("检查是否有 microtask，如果有，全部执行")]),t._v(" "),s("li",[t._v("退出该阶段")])])]),t._v(" "),s("li",[t._v("进入 idle，prepare 阶段：\n"),s("ul",[s("li",[t._v("这两个阶段与我们编程关系不大，暂且按下不表。")])])]),t._v(" "),s("li",[t._v("进入 poll 阶段")]),t._v(" "),s("li",[t._v("进入 check 阶段")]),t._v(" "),s("li",[t._v("进入 closing 阶段")]),t._v(" "),s("li",[t._v("检查是否有活跃的 handles（定时器、IO 等事件句柄） - 如果有，继续下一轮循环。 - 如果没有，结束事件循环，退出程序。\n可以发现，在事件循环的每一个子阶段"),s("strong",[t._v("退出之前")]),t._v("都会按顺序执行如下过程：")])])]),t._v(" "),s("li",[s("p",[t._v("检查是否有 "),s("code",[t._v("process.nextTick")]),t._v(" 回调，如果有，全部执行")])]),t._v(" "),s("li",[s("p",[t._v("检查是否有 "),s("code",[t._v("microtasks")]),t._v("，如果有，全部执行")])]),t._v(" "),s("li",[s("p",[t._v("退出当前阶段")])])]),t._v(" "),s("p",[s("strong",[t._v("同一次事件循环中，微任务永远在宏任务之前执行")])]),t._v(" "),s("h3",{attrs:{id:"异步事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#异步事件"}},[t._v("#")]),t._v(" 异步事件")]),t._v(" "),s("p",[t._v("非 I/O：")]),t._v(" "),s("ul",[s("li",[t._v("定时器（setTimeout，setInterval）")]),t._v(" "),s("li",[t._v("process.nextTick")]),t._v(" "),s("li",[t._v("microtask（promise）")]),t._v(" "),s("li",[t._v("setImmediate")]),t._v(" "),s("li",[t._v("DNS.lookup")])]),t._v(" "),s("p",[t._v("I/O：")]),t._v(" "),s("ul",[s("li",[t._v("网络 I/O")]),t._v(" "),s("li",[t._v("文件 I/O")]),t._v(" "),s("li",[t._v("一些 DNS 操作")])]),t._v(" "),s("h3",{attrs:{id:"宏任务和微任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#宏任务和微任务"}},[t._v("#")]),t._v(" 宏任务和微任务")]),t._v(" "),s("p",[t._v("任务队列又分为"),s("code",[t._v("macro-task（宏任务）")]),t._v("与"),s("code",[t._v("micro-task（微任务）")]),t._v("，在最新标准中，它们被分别称为"),s("code",[t._v("task")]),t._v("与"),s("code",[t._v("jobs")])]),t._v(" "),s("p",[t._v("当前执行栈执行完毕时会立刻先处理所有"),s("strong",[t._v("微任务队列")]),t._v("中的事件，然后再去"),s("strong",[t._v("宏任务队列")]),t._v("中取出一个事件。"),s("strong",[t._v("同一次事件循环中，微任务永远在宏任务之前执行")])]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("_")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("_")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[t._v("输出： 1，2，3，4")]),t._v(" "),s("ol",[s("li",[t._v("new Promise => 同步执行")]),t._v(" "),s("li",[t._v("Promise.then() => Promise.then()中注册的回调才是异步执行的；具有代表性的微任务")]),t._v(" "),s("li",[t._v("setTimeout 就是作为宏任务来存在的")])]),t._v(" "),s("ul",[s("li",[t._v("微任务：process.nextTick、Promise.then catch finally")]),t._v(" "),s("li",[t._v("宏任务： I/O，setTimeout、setInterval、setImmediate,script(整体代码),UI rendering")])]),t._v(" "),s("h2",{attrs:{id:"node-的构架"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-的构架"}},[t._v("#")]),t._v(" node 的构架")]),t._v(" "),s("p",[t._v("主要分为三层: "),s("strong",[t._v("应用 app >> V8 及 node 内置架构 >> 操作系统")])]),t._v(" "),s("p",[t._v("V8 是 node 运行的环境，可以理解为 node 虚拟机．")]),t._v(" "),s("p",[t._v("node 内置架构又可分为三层: "),s("strong",[t._v("核心模块(javascript 实现) >> c++绑定 >> libuv + CAes + http")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://muyids.oss-cn-beijing.aliyuncs.com/node-framwork.png",alt:"node的构架"}})]),t._v(" "),s("h2",{attrs:{id:"node-核心内置库及实现原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-核心内置库及实现原理"}},[t._v("#")]),t._v(" node 核心内置库及实现原理")]),t._v(" "),s("p",[t._v("常用的核心内置库如"),s("code",[t._v("事件EventEmitter")]),t._v("，"),s("code",[t._v("流Stream")]),t._v("，"),s("code",[t._v("文件fs")]),t._v("，"),s("code",[t._v("网络net,http,https")]),t._v("，"),s("code",[t._v("进程管理process、cluster")]),t._v("等")]),t._v(" "),s("h3",{attrs:{id:"global"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#global"}},[t._v("#")]),t._v(" global")]),t._v(" "),s("p",[t._v("全局对象包括：模块变量函数，Buffer 类，Timer 函数，process, console")]),t._v(" "),s("h4",{attrs:{id:"模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模块"}},[t._v("#")]),t._v(" 模块")]),t._v(" "),s("ol",[s("li",[t._v("__dirname")]),t._v(" "),s("li",[t._v("__filename")]),t._v(" "),s("li",[t._v("exports")]),t._v(" "),s("li",[t._v("module")]),t._v(" "),s("li",[t._v("require()")])]),t._v(" "),s("h3",{attrs:{id:"定时器-timer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定时器-timer"}},[t._v("#")]),t._v(" 定时器 Timer")]),t._v(" "),s("p",[t._v("js 中有哪些定时器？")]),t._v(" "),s("blockquote",[s("p",[t._v("setTimeout/clearTimeout, setInterval/clearInterval, setImmediate/clearImmediate")])]),t._v(" "),s("p",[t._v("任务执行顺序： 同步 > process.nextTick() > Promise > setTimeout(,less time) > setImmediate > setTimeout(,more time)")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// test.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4. 而setTimeout、setInterval、setImmediate的回调函数，追加在次轮循环。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 5. 而setTimeout、setInterval、setImmediate的回调函数，追加在次轮循环。")]),t._v("\nprocess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. process.nextTick和Promise的回调函数，追加在本轮循环，即同步任务一旦执行完成，就开始执行它们。")]),t._v("\nPromise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. process.nextTick和Promise的回调函数，追加在本轮循环，即同步任务一旦执行完成，就开始执行它们。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. 同步任务总是比异步任务更早执行。")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("运行结果如下")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[s("strong",[t._v("setTimeout 和 setImmediate，如果 setTimeout 的时间足够小，则 setTimeout 先执行，如果为什么？")])]),t._v(" "),s("ol",[s("li",[t._v("查看 Timer 源码，setImmediate 和 setTimeout 最终都是在一个 时间堆"),s("code",[t._v("PriorityQueue")]),t._v(" 上进行执行")]),t._v(" "),s("li",[t._v("但是，一开始 setImmediates 先加入队列 immediateQueue 使用双端链表 linkedlist 实现")]),t._v(" "),s("li",[t._v("执行的时候，setImmediates 从队列进入 时间堆"),s("code",[t._v("PriorityQueue")]),t._v("，这个过程是有代价的，所有如果 setTimeout 是 0ms 或者说时间足够小，setTimeout 先执行")])]),t._v(" "),s("h3",{attrs:{id:"进程管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#进程管理"}},[t._v("#")]),t._v(" 进程管理")]),t._v(" "),s("p",[t._v("child_process, cluster")]),t._v(" "),s("h4",{attrs:{id:"child-process-创建子进程的方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#child-process-创建子进程的方式"}},[t._v("#")]),t._v(" child_process 创建子进程的方式")]),t._v(" "),s("ul",[s("li",[t._v(".exec()、.execFile()、.fork()底层都是通过"),s("code",[t._v(".spawn()")]),t._v("实现的。")]),t._v(" "),s("li",[t._v(".exec()、execFile()额外提供了回调，当子进程停止的时候执行\n"),s("strong",[t._v("风险项")])])]),t._v(" "),s("p",[t._v("传入的命令，如果是用户输入的，有可能产生"),s("strong",[t._v("类似 sql 注入的风险")]),t._v("，比如")]),t._v(" "),s("p",[s("code",[t._v("exec('ls hello.txt', function(error, stdout, stderr){})")]),t._v("\n恶意攻击 =>\n"),s("code",[t._v("exec('ls hello.txt; rm -rf *', function(error, stdout, stderr){})")])]),t._v(" "),s("h4",{attrs:{id:"cluster"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cluster"}},[t._v("#")]),t._v(" cluster")]),t._v(" "),s("p",[t._v("master 进程通过 "),s("code",[t._v("process.fork()")]),t._v(" 创建子进程，他们之间通过 "),s("code",[t._v("IPC (内部进程通信)")]),t._v("通道实现通信。")]),t._v(" "),s("p",[t._v("操作系统的进程间通信方式: 共享内存，消息传递（socket,rpc），信号量，管道,消息队列等")]),t._v(" "),s("ol",[s("li",[t._v("共享内存；不同进程共享同一段内存空间。通常还需要引入信号量机制，来实现同步与互斥。")]),t._v(" "),s("li",[t._v("消息传递；这种模式下，进程间通过发送、接收消息来实现信息的同步。nodejs 父子进程通过事件机制通信，就是这种模型")]),t._v(" "),s("li",[t._v("信号量；信号量简单说就是系统赋予进程的一个状态值，未得到控制权的进程会在特定地方被强迫停下来，等待可以继续进行的信号到来。如果信号量只有 0 或者 1 两个值的话，又被称作“互斥锁”。这个机制也被广泛用于各种编程模式中。")]),t._v(" "),s("li",[t._v("管道；用于连接两个进程，将一个进程的输出作为另一个进程的输入\nNode.js 为父子进程的通信提供了"),s("strong",[t._v("事件机制 EventEmmiter")]),t._v("来传递消息。")])]),t._v(" "),s("h5",{attrs:{id:"负载均衡策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡策略"}},[t._v("#")]),t._v(" 负载均衡策略")]),t._v(" "),s("p",[t._v("Node.js 默认采用的策略是 round-robin 时间片轮转法。")]),t._v(" "),s("p",[t._v("负载均衡算法:")]),t._v(" "),s("ul",[s("li",[t._v("round-robin "),s("strong",[t._v("时间片轮转法")]),t._v("; 每一次把来自用户的请求轮流分配给各个进程，不足：处理效率不一样，会出现负载不均衡")]),t._v(" "),s("li",[t._v("WRR (weight-round-robin) "),s("strong",[t._v("加权轮转法")]),t._v("；\n时间片轮转法（round-robin）"),s("strong",[t._v("不适用于 windows")]),t._v(", 第二种方式是由主进程创建 socket 监听端口后, 将 "),s("strong",[t._v("socket 句柄直接分发")]),t._v("给相应的 worker, 然后当连接进来时, 就直接由相应的 worker 来接收连接并处理；存在负载不均衡的问题, 比如通常 70% 的连接仅被 8 个进程中的 2 个处理, 而其他进程比较清闲.")])]),t._v(" "),s("h5",{attrs:{id:"多进程的端口监听"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多进程的端口监听"}},[t._v("#")]),t._v(" 多进程的端口监听")]),t._v(" "),s("ol",[s("li",[t._v("master 进程负责监听端口")]),t._v(" "),s("li",[t._v("然后将连接通过某种分发策略（比如 round-robin），转发给 worker 进程。")]),t._v(" "),s("li",[t._v("这样由于只有 master 进程接收客户端连接，就解决了竞争导致的负载不均衡的问题")]),t._v(" "),s("li",[t._v("关键：要求 master 进程的稳定性足够好")])]),t._v(" "),s("h3",{attrs:{id:"eventemitter"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eventemitter"}},[t._v("#")]),t._v(" EventEmitter")]),t._v(" "),s("p",[t._v("EventEmitter 是 node 中一个实现"),s("strong",[t._v("观察者模式")]),t._v("的类，主要功能是"),s("strong",[t._v("监听和发射消息，用于处理多模块交互问题")])]),t._v(" "),s("h4",{attrs:{id:"代码实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码实现"}},[t._v("#")]),t._v(" 代码实现")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" util "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"util"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" EventEmitter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"events"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EventEmitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("MyEmitter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("EventEmitter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 构造函数")]),t._v("\n\nutil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("inherits")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MyEmitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" EventEmitter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 继承")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" em "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyEmitter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"收到事件hello的数据:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 接收事件，并打印到控制台")]),t._v("\nem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("emit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EventEmitter传递消息真方便!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br")])]),s("h4",{attrs:{id:"eventemitter-有哪些典型应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eventemitter-有哪些典型应用"}},[t._v("#")]),t._v(" EventEmitter 有哪些典型应用")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("模块间传递消息")])]),t._v(" "),s("li",[s("strong",[t._v("回调函数内外传递消息")])]),t._v(" "),s("li",[t._v("处理"),s("strong",[t._v("流数据")]),t._v("，因为流是在 EventEmitter 基础上实现的.")]),t._v(" "),s("li",[s("strong",[t._v("观察者模式发射触发机制")]),t._v("相关应用")])]),t._v(" "),s("h4",{attrs:{id:"怎么捕获-eventemitter-的错误事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#怎么捕获-eventemitter-的错误事件"}},[t._v("#")]),t._v(" 怎么捕获 EventEmitter 的错误事件")]),t._v(" "),s("p",[s("strong",[t._v("监听 error 事件")]),t._v("即可．如果有多个 EventEmitter,也可以用"),s("strong",[t._v("domain 来统一处理错误事件")])]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" domain "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"domain"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" myDomain "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" domain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmyDomain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"domain接收到的错误事件:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 接收事件并打印")]),t._v("\nmyDomain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" emitter1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyEmitter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  emitter1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("emit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"错误事件来自emitter1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  emitter2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyEmitter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  emitter2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("emit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"错误事件来自emitter2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("h4",{attrs:{id:"eventemitter-中的-newlistenser-事件有什么用处"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eventemitter-中的-newlistenser-事件有什么用处"}},[t._v("#")]),t._v(" EventEmitter 中的 newListenser 事件有什么用处")]),t._v(" "),s("p",[s("code",[t._v("newListener")]),t._v("可以用来做事件机制的反射，特殊应用，事件管理等")]),t._v(" "),s("p",[s("strong",[t._v("当任何 on 事件添加到 EventEmitter 时，就会触发 newListener 事件")]),t._v("，基于这种模式，我们可以做很多自定义处理.")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" emitter3 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyEmitter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nemitter3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"newListener"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" listener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"新事件的名字:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"新事件的代码:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" listener"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"我是自定义延时处理机制"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nemitter3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello　node"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("h3",{attrs:{id:"stream"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stream"}},[t._v("#")]),t._v(" Stream")]),t._v(" "),s("p",[t._v("stream 是基于事件"),s("code",[t._v("EventEmitter")]),t._v("的数据管理模式．由各种不同的抽象接口组成，主要包括"),s("code",[t._v("可写，可读，可读写，可转换等")]),t._v("几种类型")]),t._v(" "),s("h4",{attrs:{id:"stream-有什么好处"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stream-有什么好处"}},[t._v("#")]),t._v(" Stream 有什么好处")]),t._v(" "),s("p",[s("code",[t._v("非阻塞式数据处理")]),t._v("提升效率，片断处理节省内存，"),s("code",[t._v("管道处理")]),t._v("方便可扩展等")]),t._v(" "),s("h4",{attrs:{id:"stream-有哪些典型应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stream-有哪些典型应用"}},[t._v("#")]),t._v(" Stream 有哪些典型应用")]),t._v(" "),s("p",[t._v("文件，网络，数据转换，音频视频等")]),t._v(" "),s("h4",{attrs:{id:"怎么捕获-stream-的错误事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#怎么捕获-stream-的错误事件"}},[t._v("#")]),t._v(" 怎么捕获 Stream 的错误事件")]),t._v(" "),s("p",[t._v("监听"),s("code",[t._v("error")]),t._v("事件，方法同 EventEmitter")]),t._v(" "),s("h4",{attrs:{id:"有哪些常用-stream-分别什么时候使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#有哪些常用-stream-分别什么时候使用"}},[t._v("#")]),t._v(" 有哪些常用 Stream,分别什么时候使用")]),t._v(" "),s("ul",[s("li",[t._v("可读流"),s("code",[t._v("Readable")]),t._v("，在作为输入数据源时使用；")]),t._v(" "),s("li",[t._v("可写流"),s("code",[t._v("Writable")]),t._v(",在作为输出源时使用；")]),t._v(" "),s("li",[t._v("双工流"),s("code",[t._v("Duplex")]),t._v(",它作为输出源接受被写入，同时又作为输入源被后面的流读出．")]),t._v(" "),s("li",[t._v("转换流"),s("code",[t._v("Transform")]),t._v("，跟"),s("code",[t._v("Duplex")]),t._v("一样，都是双向流，但它的输出与输入是相关联的\n"),s("ul",[s("li",[t._v("需要实现一个函数"),s("code",[t._v("_transfrom(chunk, encoding, callback)")]),t._v(";而 Duplex 需要分别实现"),s("code",[t._v("_read(size)")]),t._v("函数和"),s("code",[t._v("_write(chunk, encoding, callback)")]),t._v("函数")])])])]),t._v(" "),s("h4",{attrs:{id:"缓冲"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缓冲"}},[t._v("#")]),t._v(" 缓冲")]),t._v(" "),s("p",[t._v("highWaterMark")]),t._v(" "),s("p",[t._v("可缓冲的数据大小取决于传入流构造函数的 highWaterMark 选项。 对于普通的流， highWaterMark 指定了字节的总数。 对于对象模式的流， highWaterMark 指定了对象的总数。")]),t._v(" "),s("p",[t._v("限制数据的缓冲到可接受的程度，也就是"),s("strong",[t._v("读写速度不一致的源头与目的地不会压垮内存")])]),t._v(" "),s("h4",{attrs:{id:"实现一个-writable-stream"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现一个-writable-stream"}},[t._v("#")]),t._v(" 实现一个 Writable Stream")]),t._v(" "),s("p",[t._v("三步走:")]),t._v(" "),s("ol",[s("li",[t._v("继承"),s("code",[t._v("Writable")])]),t._v(" "),s("li",[t._v("覆写原型链方法"),s("code",[t._v("_write(chunk, encoding, callback)")]),t._v("函数\n代码实现：")])]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" Writable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stream"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Writable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" util "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"util"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("MyWritable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Writable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 构造继承")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nutil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("inherits")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MyWritable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Writable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 继承Writable")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyWritable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("_write")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("chunk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" encoding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"被写入的数据是:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" chunk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此处可对写入的数据进行处理")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nprocess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyWritable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// stdin作为输入源，MyWritable作为输出源")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("h3",{attrs:{id:"文件系统-fs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件系统-fs"}},[t._v("#")]),t._v(" 文件系统 fs")]),t._v(" "),s("p",[t._v("Node 通过 fs 模块来和"),s("strong",[t._v("文件系统")]),t._v("进行交互，该模块提供了一些"),s("strong",[t._v("标准的文件访问 API 类")]),t._v("打开、读取、写入文件、以及与其交互。")]),t._v(" "),s("h4",{attrs:{id:"内置的-fs-模块架构是什么样子的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内置的-fs-模块架构是什么样子的"}},[t._v("#")]),t._v(" 内置的 fs 模块架构是什么样子的")]),t._v(" "),s("p",[t._v("fs 模块主要由下面几部分组成:")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("POSIX 文件操作的封装")]),t._v(",对应于"),s("strong",[t._v("操作系统的原生文件操作")]),t._v("; unlink,stat,rename...")]),t._v(" "),s("li",[t._v("文件流 fs.createReadStream 和 fs.createWriteStream")]),t._v(" "),s("li",[t._v("同步文件读写, fs.readFileSync 和 fs.writeFileSync")]),t._v(" "),s("li",[t._v("异步文件读写, fs.readFile 和 fs.writeFile")])]),t._v(" "),s("h4",{attrs:{id:"读写一个文件有多少种方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#读写一个文件有多少种方法"}},[t._v("#")]),t._v(" 读写一个文件有多少种方法")]),t._v(" "),s("p",[t._v("总体来说有四种:")]),t._v(" "),s("ol",[s("li",[t._v("POSIX 式底层读写")]),t._v(" "),s("li",[t._v("流式读写")]),t._v(" "),s("li",[t._v("同步读写")]),t._v(" "),s("li",[t._v("异步读写")])]),t._v(" "),s("h4",{attrs:{id:"怎么读取-json-配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#怎么读取-json-配置文件"}},[t._v("#")]),t._v(" 怎么读取 json 配置文件")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("利用 node 内置的"),s("code",[t._v("require('data.json')")]),t._v("机制 ("),s("strong",[t._v("注意")]),t._v("：其中一个改变了 js 对象，其它跟着改变)")])]),t._v(" "),s("li",[s("p",[t._v("读入文件入内容，然后用"),s("code",[t._v("JSON.parse(content)")]),t._v("转换成 js 对象\n两种方式的区别：")])]),t._v(" "),s("li",[s("p",[t._v("require 机制情况下，如果多个模块都加载了同一个 json 文件，那么其中一个改变了 js 对象，其它跟着改变，这是由 node 模块的"),s("strong",[t._v("缓存机制")]),t._v("造成的，只有一个 js 模块对象")])]),t._v(" "),s("li",[s("p",[t._v("第二种方式则可以随意改变加载后的 js 变量，而且各模块互不影响，因为他们都是独立的，是多个 js 对象")])])]),t._v(" "),s("h4",{attrs:{id:"fs-watch-和-fs-watchfile-有什么区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fs-watch-和-fs-watchfile-有什么区别"}},[t._v("#")]),t._v(" fs.watch 和 fs.watchFile 有什么区别")]),t._v(" "),s("p",[t._v("二者主要用来监听文件变动")]),t._v(" "),s("ol",[s("li",[t._v("fs.watch 利用操作系统原生机制来监听，可能不适用网络文件系统;")]),t._v(" "),s("li",[t._v("fs.watchFile 则是定期检查文件状态变更，适用于网络文件系统，但是相比 fs.watch 有些慢，因为不是实时机制．")])]),t._v(" "),s("h3",{attrs:{id:"网络"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#网络"}},[t._v("#")]),t._v(" 网络")]),t._v(" "),s("h4",{attrs:{id:"node-的网络模块架构是什么样子的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-的网络模块架构是什么样子的"}},[t._v("#")]),t._v(" node 的网络模块架构是什么样子的")]),t._v(" "),s("p",[t._v("node 全面支持各种网络服务器和客户端，包括"),s("code",[t._v("http/https, tcp, udp, dns, tls/ssl")]),t._v("等")]),t._v(" "),s("h4",{attrs:{id:"node-是怎样支持-https-tls-的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-是怎样支持-https-tls-的"}},[t._v("#")]),t._v(" node 是怎样支持 https,tls 的")]),t._v(" "),s("p",[t._v("要实现以下几个步骤即可:")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("openssl")]),t._v("生成公钥私钥")]),t._v(" "),s("li",[t._v("服务器或客户端使用"),s("code",[t._v("https")]),t._v("替代 http")]),t._v(" "),s("li",[t._v("服务器或客户端加载公钥私钥证书")])]),t._v(" "),s("h2",{attrs:{id:"优雅退出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优雅退出"}},[t._v("#")]),t._v(" 优雅退出")]),t._v(" "),s("p",[s("code",[t._v("graceful")]),t._v("模块配合"),s("code",[t._v("cluster")]),t._v("就可以实现这个解决方案。")]),t._v(" "),s("p",[t._v("graceful 是基于 domain 模块实现的")]),t._v(" "),s("p",[t._v("domain 能捕捉异步回调中出现的异常。（弥补 try...catch...的不足）")]),t._v(" "),s("p",[t._v("process.on('uncaughtException)")]),t._v(" "),s("h2",{attrs:{id:"错误优先的回调函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误优先的回调函数"}},[t._v("#")]),t._v(" 错误优先的回调函数")]),t._v(" "),s("p",[t._v("错误优先的回调函数用于传递错误和数据。第一个参数始终应该是一个错误对象， 用于检查程序是否发生了错误。其余的参数用于传递数据。")]),t._v(" "),s("p",[t._v("只有遵循错误优先回调的函数可以 promisify")]),t._v(" "),s("h2",{attrs:{id:"如何避免回调地狱"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何避免回调地狱"}},[t._v("#")]),t._v(" 如何避免回调地狱")]),t._v(" "),s("ul",[s("li",[t._v("使用三方库，Q, blubird, async 进行 promisify")]),t._v(" "),s("li",[t._v("使用 Promise 链式调用")]),t._v(" "),s("li",[t._v("使用 yield+生成器 generator 或 Promise, co")]),t._v(" "),s("li",[t._v("使用 async, await 语法糖 ES6")])]),t._v(" "),s("h2",{attrs:{id:"什么是-stub"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-stub"}},[t._v("#")]),t._v(" 什么是 stub")]),t._v(" "),s("p",[s("code",[t._v("TDD、Stub和Mock")])]),t._v(" "),s("p",[s("code",[t._v("stub")]),t._v("存在的意图是为了让测试对象可以正常的执行，硬编码一些输入和输出")]),t._v(" "),s("p",[s("code",[t._v("mock")]),t._v("除了保证 stub 的功能之外，还可深入的模拟对象之间的交互方式，如：调用了几次、在某种情况下是否会抛出异常")]),t._v(" "),s("p",[t._v("stub 是 mock 的子集")]),t._v(" "),s("h2",{attrs:{id:"express-的路由机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#express-的路由机制"}},[t._v("#")]),t._v(" express 的路由机制")]),t._v(" "),s("p",[t._v("express 是如何从一个中间件执行到下一个中间件的?")]),t._v(" "),s("p",[t._v("A: "),s("code",[t._v("app.use()")])]),t._v(" "),s("p",[t._v("app.use()的原理是什么？")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("middleware")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 做该干的事")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 做完后调用下一个函数")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// next也是一个函数，它表示函数数组中的下一个函数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("其实所有中间件函数，是顺序添加到"),s("strong",[t._v("中间件数组")]),t._v("里面，这个函数数组表示在发出响应之前要执行的所有函数")]),t._v(" "),s("p",[t._v("使用 app.use(fn)后，传进来的 fn 就会被扔到这个数组里，执行完毕后调用 next()方法执行函数数组里的下一个函数，如果没有调用 next()的话，就不会调用下一个函数了，也就是说调用就会被终止")]),t._v(" "),s("h2",{attrs:{id:"express-和-koa-的区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#express-和-koa-的区别"}},[t._v("#")]),t._v(" Express 和 Koa 的区别")]),t._v(" "),s("ol",[s("li",[t._v("Handler 处理方式\n"),s("ul",[s("li",[t._v("Express 使用普通的回调函数，一种线性的逻辑，在同一个线程上完成所有的 HTTP 请求;异步操作的执行顺序不确定；回调的方式不利于错误捕获；")]),t._v(" "),s("li",[t._v("使用 ES7 的"),s("strong",[t._v("Async/Await")]),t._v("替换了原来的 "),s("strong",[t._v("Generator + co")]),t._v(" 的模式; "),s("strong",[t._v("Async/Await")]),t._v(" 现在也称为 JS 异步的终极解决方案。")])])]),t._v(" "),s("li",[t._v("中间件实现机制\n"),s("ul",[s("li",[t._v("koa2: 中间件 Compose;洋葱圈模型;会去等待异步（Promise）完成;可以非常方便的"),s("strong",[t._v("实现后置处理逻辑")])]),t._v(" "),s("li",[t._v("Express 中间件实现是基于 Callback 回调函数同步的，它"),s("strong",[t._v("不会去等待异步（Promise）完成")])])])]),t._v(" "),s("li",[t._v("响应机制\n"),s("ul",[s("li",[t._v("在 Koa 中数据的响应是通过 ctx.body 进行设置，注意这里仅是设置并没有立即响应，而是在所有的中间件结束之后做了响应;这样做一个好处是我们在响应之前是有一些预留操作空间的，")]),t._v(" "),s("li",[s("code",[t._v("express:res.send()")]),t._v(" 之后就立即响应了，这样如果还想在上层中间件做一些操作是有点难的。")])])])]),t._v(" "),s("p",[t._v("其实，Express 也是类似的洋葱模型，不同的是：")]),t._v(" "),s("p",[t._v("Express 中间件机制使用了 Callback 实现，这样如果出现异步则可能会使你在执行顺序上感到困惑，因此如果我们想做接口耗时统计、错误处理 Koa 的这种中间件模式处理起来更方便些。最后一点响应机制也很重要，Koa 不是立即响应，是整个中间件处理完成在最外层进行了响应，而 Express 则是立即响应。")]),t._v(" "),s("h2",{attrs:{id:"egg-js-和-nest-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#egg-js-和-nest-js"}},[t._v("#")]),t._v(" egg.js 和 nest.js")]),t._v(" "),s("ul",[s("li",[t._v("egg.js 是在 koa 的基础上做了一层很好的面向大型企业级应用的框架封装")]),t._v(" "),s("li",[t._v("egg 支持 ts")]),t._v(" "),s("li",[t._v("egg.js 更多的是按照"),s("strong",[t._v("洋葱模型")]),t._v("的开发方式，和 AOP 编程还是有点区别的")]),t._v(" "),s("li",[t._v("NEST.js 配合 typeorm 可以在 node 下拥有不输 Spring 的"),s("strong",[t._v("面向切面编程")]),t._v("的体验")])])])}),[],!1,null,null,null);s.default=e.exports}}]);