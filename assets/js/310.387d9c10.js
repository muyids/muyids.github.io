(window.webpackJsonp=window.webpackJsonp||[]).push([[310],{583:function(v,_,t){"use strict";t.r(_);var s=t(14),r=Object(s.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("p",[v._v("缓存雪崩、穿透、击穿问题")]),v._v(" "),_("h2",{attrs:{id:"缓存雪崩"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#缓存雪崩"}},[v._v("#")]),v._v(" 缓存雪崩")]),v._v(" "),_("p",[_("strong",[v._v("缓存雪崩")]),v._v(", 即缓存"),_("strong",[v._v("同一时间大面积的失效")]),v._v("，这个时候又来了一波请求，结果请求都打到数据库上，从而导致数据库连接异常。")]),v._v(" "),_("p",[v._v("发生原因：")]),v._v(" "),_("ul",[_("li",[v._v("缓存服务宕机")]),v._v(" "),_("li",[v._v("大量 key 同时过期\n"),_("strong",[v._v("解决方案：")])])]),v._v(" "),_("p",[v._v("避免发生：")]),v._v(" "),_("ul",[_("li",[_("p",[_("strong",[v._v("服务高可用")]),v._v("：主从+哨兵，redis cluster，避免服务崩溃")])]),v._v(" "),_("li",[_("p",[_("strong",[v._v("随机失效时间")]),v._v("：不同的 key，设置不同的过期时间，让缓存失效的时间点尽量均匀。")])]),v._v(" "),_("li",[_("p",[v._v("**二级缓存：**A1 为原始缓存，A2 为拷贝缓存，A1 短期，A2 长期；A1 失效时，可以访问 A2")])]),v._v(" "),_("li",[_("p",[_("strong",[v._v("数据预热")]),v._v("：将发生大并发访问前，预先访问一遍")])])]),v._v(" "),_("p",[v._v("雪崩保护：")]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("限流策略")]),v._v("：发生雪崩事中：本地"),_("code",[v._v("ehcache")]),v._v("缓存 + "),_("code",[v._v("hystrix")]),v._v(" ，避免 MySQL 被打死")])]),v._v(" "),_("h2",{attrs:{id:"缓存穿透"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#缓存穿透"}},[v._v("#")]),v._v(" 缓存穿透")]),v._v(" "),_("p",[_("strong",[v._v("缓存穿透")]),v._v("，即黑客故意去"),_("strong",[v._v("请求缓存中不存在的数据")]),v._v("，导致所有的请求都怼到数据库上，从而数据库连接异常。")]),v._v(" "),_("p",[v._v("低频的缓存穿透是 正常的，高频的缓存穿透才会影响数据库")]),v._v(" "),_("h3",{attrs:{id:"缓存穿透解决方案"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#缓存穿透解决方案"}},[v._v("#")]),v._v(" 缓存穿透解决方案")]),v._v(" "),_("ol",[_("li",[v._v("同样的请求 ID 的情况；\n"),_("ul",[_("li",[_("strong",[v._v("分布式锁")]),v._v("，使用"),_("strong",[v._v("互斥锁")]),v._v("更新，保证同一个进程中针对同一个数据不会并发请求到 DB，减小 DB 压力。")]),v._v(" "),_("li",[v._v("把查询到的结果（正常查询结果、NULL 值等）写入到缓存中，可以过滤掉同样的请求")])])]),v._v(" "),_("li",[v._v("每次都是 不同的 ID（最常见的攻击场景）；")])])])}),[],!1,null,null,null);_.default=r.exports}}]);