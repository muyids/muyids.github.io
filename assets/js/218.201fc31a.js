(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{493:function(t,s,a){"use strict";a.r(s);var r=a(14),n=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"ribbon-负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ribbon-负载均衡"}},[t._v("#")]),t._v(" Ribbon 负载均衡")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Ribbon 目前也进入维护,基本上不准备更新了")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%842.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("进程内 LB(本地负载均衡)")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%845.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("集中式 LB(服务端负载均衡)")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%844.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("区别")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%843.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Ribbon 就是负载均衡+RestTemplate")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%846.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%847.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%848.png",alt:""}})]),t._v(" "),s("h1",{attrs:{id:"使用-ribbon"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-ribbon"}},[t._v("#")]),t._v(" 使用 Ribbon")]),t._v(" "),s("h2",{attrs:{id:"默认我们使用-eureka-的新版本时-它默认集成了-ribbon"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#默认我们使用-eureka-的新版本时-它默认集成了-ribbon"}},[t._v("#")]),t._v(" 默认我们使用 eureka 的新版本时,它默认集成了 ribbon:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%849.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("==这个 starter 中集成了 reibbon 了==")])]),t._v(" "),s("h2",{attrs:{id:"我们也可以手动引入-ribbon"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#我们也可以手动引入-ribbon"}},[t._v("#")]),t._v(" 我们也可以手动引入 ribbon")]),t._v(" "),s("p",[s("strong",[t._v("放到 order 模块中,因为只有 order 访问 pay 时需要负载均衡")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8410.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"resttemplate-类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#resttemplate-类"}},[t._v("#")]),t._v(" RestTemplate 类")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8411.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8412.png",alt:""}})]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),t._v("的"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("xxxForObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("方法"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("返回的是响应体中的数据\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("xxxForEntity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("方法"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("返回的是entity对象"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("这个对象不仅仅包含响应体数据"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("还包含响应体信息"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("状态码等"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("h2",{attrs:{id:"ribbon-常用负载均衡算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ribbon-常用负载均衡算法"}},[t._v("#")]),t._v(" Ribbon 常用负载均衡算法:")]),t._v(" "),s("p",[s("strong",[t._v("IRule 接口,Riboon 使用该接口,根据特定算法从所有服务中,选择一个服务,")])]),t._v(" "),s("p",[s("strong",[t._v("Rule 接口有 7 个实现类,每个实现类代表一个负载均衡算法")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8414.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"使用-ribbon-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-ribbon-2"}},[t._v("#")]),t._v(" 使用 Ribbon")]),t._v(" "),s("p",[s("strong",[t._v("==这里使用 eureka 的那一套服务==")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8415.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("==也就是不能放在主启动类所在的包及子包下==")])]),t._v(" "),s("h3",{attrs:{id:"修改-order-模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改-order-模块"}},[t._v("#")]),t._v(" 修改 order 模块")]),t._v(" "),s("h3",{attrs:{id:"额外创建一个包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#额外创建一个包"}},[t._v("#")]),t._v(" 额外创建一个包")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8416.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"创建配置类-指定负载均衡算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建配置类-指定负载均衡算法"}},[t._v("#")]),t._v(" 创建配置类,指定负载均衡算法")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8417.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"在主启动类上加一个注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在主启动类上加一个注解"}},[t._v("#")]),t._v(" 在主启动类上加一个注解")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8418.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("表示,访问 CLOUD_pAYMENT_SERVICE 的服务时,使用我们自定义的负载均衡算法")])]),t._v(" "),s("h2",{attrs:{id:"自定义负载均衡算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义负载均衡算法"}},[t._v("#")]),t._v(" 自定义负载均衡算法")]),t._v(" "),s("h3",{attrs:{id:"ribbon-的轮询算法原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ribbon-的轮询算法原理"}},[t._v("#")]),t._v(" ribbon 的轮询算法原理")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8419.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8421.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"自定义负载均衡算法-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义负载均衡算法-2"}},[t._v("#")]),t._v(" 自定义负载均衡算法")]),t._v(" "),s("p",[s("strong",[t._v("给 pay 模块(8001,8002),的 controller 方法添加一个方法,返回当前节点端口")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8423.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8422.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("修改 order 模块")])]),t._v(" "),s("p",[t._v("去掉@LoadBalanced")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8424.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"自定义接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义接口"}},[t._v("#")]),t._v(" 自定义接口")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/Ribbon%E7%9A%8429.png",alt:""}})]),t._v(" "),s("p",[t._v("==具体的算法在实现类中实现==")]),t._v(" "),s("h3",{attrs:{id:"接口实现类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#接口实现类"}},[t._v("#")]),t._v(" 接口实现类")])])}),[],!1,null,null,null);s.default=n.exports}}]);