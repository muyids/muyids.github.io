(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{315:function(v,_,e){"use strict";e.r(_);var i=e(14),l=Object(i.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("p",[v._v("分布式服务框架-注册中心 : https://juejin.cn/post/6997940076986515492?utm_source=gold_browser_extension")]),v._v(" "),_("p",[v._v("zookeeper 之 ZkClient：https://link.juejin.cn/?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000021258723")]),v._v(" "),_("p",[v._v("命令行工具 zkCli.sh 的使用：http://wiki.ai.fltrp.im/%E4%B8%AD%E9%97%B4%E4%BB%B6/zookeeper/")]),v._v(" "),_("ul",[_("li",[v._v("客户端 zkCli.sh -timeout 5000 -server 129.0.4.32:2181")])]),v._v(" "),_("p",[v._v("zk ui:")]),v._v(" "),_("ul",[_("li",[v._v("访问地址： http://127.0.0.1:9090/home")])]),v._v(" "),_("p",[v._v("项目代码：")]),v._v(" "),_("ul",[_("li",[v._v("本地：/Users/dw/workspace/knowledge/simple-rpc\ngithub : https://github.com/MIracleCczs/simple-rpc")]),v._v(" "),_("li",[v._v("我自己的项目: /Users/dw/workspace/muyids/cloudAli/register-center")])]),v._v(" "),_("p",[v._v("注册中心架构")]),v._v(" "),_("p",[v._v("nacos 架构设计 https://zhuanlan.zhihu.com/p/344572647")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("service")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("Service 对象")]),v._v(" "),_("div",{staticClass:"language- line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[v._v("{\n\t服务名\n\t[] 服务实例对象列表: {\n\t\thost+port\n\t}\n}\n")])]),v._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[v._v("1")]),_("br"),_("span",{staticClass:"line-number"},[v._v("2")]),_("br"),_("span",{staticClass:"line-number"},[v._v("3")]),_("br"),_("span",{staticClass:"line-number"},[v._v("4")]),_("br"),_("span",{staticClass:"line-number"},[v._v("5")]),_("br"),_("span",{staticClass:"line-number"},[v._v("6")]),_("br")])])]),v._v(" "),_("li",[_("p",[v._v("通知订阅者")])]),v._v(" "),_("li",[_("p",[v._v("通知持久化")])])])]),v._v(" "),_("li",[_("p",[v._v("controller")]),v._v(" "),_("ul",[_("li",[v._v("http 请求注册")])])]),v._v(" "),_("li",[_("p",[v._v("subscriber")]),v._v(" "),_("ul",[_("li",[v._v("订阅者")])])])]),v._v(" "),_("p",[v._v("图灵学院 》手写 zookeeper 分布式注册中心 https://www.bilibili.com/video/BV1ZE411i7uE")]),v._v(" "),_("p",[v._v("Dubbo 推荐使用 zookeeper 做注册中心")]),v._v(" "),_("hr"),v._v(" "),_("ul",[_("li",[_("p",[v._v("服务（持久节点） /zkRegister/${servicename}")]),v._v(" "),_("ul",[_("li",[v._v("服务提供者 1（临时节点）/pid1 {ip:port,servicename,pid 等信息}")]),v._v(" "),_("li",[v._v("服务提供者 2（临时节点）/pid2 {ip:port,servicename,pid 等信息}")]),v._v(" "),_("li",[v._v("。。。\n功能：")])])]),v._v(" "),_("li",[_("p",[v._v("注册服务")])]),v._v(" "),_("li",[_("p",[v._v("订阅服务\n模块抽象：")])]),v._v(" "),_("li",[_("p",[v._v("注册中心 IRegister")]),v._v(" "),_("p",[v._v("负责注册服务，获取服务列表，服务下线等功能")]),v._v(" "),_("ul",[_("li",[v._v("实现类 ZkRegister")])])]),v._v(" "),_("li",[_("p",[v._v("Client 层")]),v._v(" "),_("p",[v._v("客户端接入")]),v._v(" "),_("ul",[_("li",[v._v("注册服务")]),v._v(" "),_("li",[v._v("订阅服务列表 - 调用别的服务")])])]),v._v(" "),_("li",[_("p",[v._v("Controller 层")]),v._v(" "),_("p",[v._v("http/rpc 调用")]),v._v(" "),_("p",[v._v("Netty")])]),v._v(" "),_("li",[_("p",[v._v("中间件")]),v._v(" "),_("ul",[_("li",[v._v("zk : zookeeper 的连接")])])])]),v._v(" "),_("p",[v._v("服务注册：")]),v._v(" "),_("ol",[_("li",[_("p",[v._v("Client 端通知 注册中心")]),v._v(" "),_("p",[v._v("通知方式：")]),v._v(" "),_("p",[v._v("接口调用 IRegister.register(HostInfo info)")])]),v._v(" "),_("li",[_("p",[v._v("注册中心创建服务")]),v._v(" "),_("ol",[_("li",[v._v("创建持久化节点（已存在则不创建）")]),v._v(" "),_("li",[v._v("创建临时节点\n订阅功能实现：")])])])]),v._v(" "),_("p",[v._v("基于 zookeeper 的 watch 机制")]),v._v(" "),_("ol",[_("li",[v._v("获取 service 持久节点列表")]),v._v(" "),_("li",[v._v("订阅 service 持久节点的子节点的变化\n获取服务列表：")])]),v._v(" "),_("ul",[_("li",[v._v("注册中心 从 zookeeper 获取")]),v._v(" "),_("li",[v._v("本地维护一份\n心跳机制：")])]),v._v(" "),_("p",[v._v("客户端一旦断开，服务端需要等 10s 才将客户端注册的临时节点删除")]),v._v(" "),_("p",[v._v("原理：")]),v._v(" "),_("ul",[_("li",[v._v("客户端每隔 1s 向服务端发送一次通知")]),v._v(" "),_("li",[v._v("注册中心维护每一个客户端的最近心跳时间")]),v._v(" "),_("li",[v._v("间隔 3s 未收到心跳，则断开客户端连接，并删除客户端的临时节点")])]),v._v(" "),_("p",[v._v("知识点：")]),v._v(" "),_("ul",[_("li",[v._v("服务节点用持久节点的原因：临时节点不能创建子节点")]),v._v(" "),_("li",[v._v("服务提供者节点用临时节点原因：下线的时候临时节点自动删除")])]),v._v(" "),_("hr")])}),[],!1,null,null,null);_.default=l.exports}}]);