(window.webpackJsonp=window.webpackJsonp||[]).push([[460],{734:function(s,a,t){"use strict";t.r(a);var v=t(14),e=Object(v.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[s._v("#")]),s._v(" 概念")]),s._v(" "),a("p",[s._v("Ansible 是一种由 Python 开发的自动化运维工具，集合了众多运维工具（puppet、cfengine、chef、func、fabric）的优点，实现了"),a("strong",[s._v("批量系统配置")]),s._v("、"),a("strong",[s._v("批量程序部署")]),s._v("、"),a("strong",[s._v("批量运行命令")]),s._v("等功能，是一款"),a("strong",[s._v("轻量级的配置自动化工具")]),s._v("。")]),s._v(" "),a("p",[s._v("Ansible 是基于模块工作的，本身没有批量部署的能力。真正具有批量部署的是 ansible 所运行的模块，ansible 只是提供一种框架。主要包括：")]),s._v(" "),a("p",[s._v("​ (1) "),a("strong",[s._v("连接插件 connection plugins")]),s._v("：负责和被管控端实现通信；")]),s._v(" "),a("p",[s._v("​ (2) "),a("strong",[s._v("host inventory")]),s._v("：指定操作的主机，是一个配置文件里面定义管控的主机;")]),s._v(" "),a("p",[s._v("​ (3) "),a("strong",[s._v("各种模块核心模块、 command 模块、自定义模块")]),s._v("；")]),s._v(" "),a("p",[s._v("​ (4) 借助于"),a("strong",[s._v("插件")]),s._v("完成记录日志邮件等功能；")]),s._v(" "),a("p",[s._v("​ (5) "),a("strong",[s._v("playbook")]),s._v("：剧本执行多个任务时，可以让被管控端一次性运行多个任务;")]),s._v(" "),a("h1",{attrs:{id:"ansible-特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ansible-特性"}},[s._v("#")]),s._v(" Ansible 特性")]),s._v(" "),a("p",[s._v("​ (1) no agents："),a("strong",[s._v("不需要在被管控主机上安装任何客户端")]),s._v("；")]),s._v(" "),a("p",[s._v("​ (2) no server："),a("strong",[s._v("无服务器端")]),s._v("，使用时直接运行命令即可；")]),s._v(" "),a("p",[s._v("​ (3) modules in any languages："),a("strong",[s._v("基于模块工作")]),s._v("，可使用任意语言开发模块；")]),s._v(" "),a("p",[s._v("​ (4) yaml，not code："),a("strong",[s._v("使用 yaml 语言定制剧本 playbook")]),s._v("；")]),s._v(" "),a("p",[s._v("​ (5) ssh by default："),a("strong",[s._v("基于 SSH 工作")]),s._v("；")]),s._v(" "),a("p",[s._v("​ (6) strong multi-tier solution："),a("strong",[s._v("可实现多级指挥")]),s._v("；")]),s._v(" "),a("h1",{attrs:{id:"ansible-优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ansible-优点"}},[s._v("#")]),s._v(" Ansible 优点")]),s._v(" "),a("p",[s._v("​ (1) "),a("strong",[s._v("轻量级")]),s._v("，无需在客户端安装 agent，更新时，只需在操作机上进行一次更新即可；")]),s._v(" "),a("p",[s._v("​ (2) 批量任务执行可以写成脚本，而且不用分发到远程就可以执行；")]),s._v(" "),a("p",[s._v("​ (3) 使用 python 编写，维护更简单，ruby 语法过于复杂；")]),s._v(" "),a("p",[s._v("​ (4) 支持 sudo；")]),s._v(" "),a("h1",{attrs:{id:"ansible-架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ansible-架构"}},[s._v("#")]),s._v(" Ansible 架构")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://muyids.oss-cn-beijing.aliyuncs.com/img/202205061500474.png",alt:"image-20220506150017048"}})]),s._v(" "),a("p",[a("strong",[a("em",[s._v("Ansible 的架构")])]),s._v("，主要分为以下几部分内容：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ansible")]),s._v("：核心，提供一种框架")]),s._v(" "),a("li",[a("strong",[s._v("Connection Plugins")]),s._v("：连接插件,负责和被操作端实现通信，可通过多种方式与被操作端连接，例如：local、ssh、zeromq，默认使用 ssh；")]),s._v(" "),a("li",[a("strong",[s._v("Host Inventory")]),s._v("：主机清单，指定被操作主机;")]),s._v(" "),a("li",[a("strong",[s._v("Core Modules")]),s._v("：各种模块核心模块，Ansible 已自带")]),s._v(" "),a("li",[a("strong",[s._v("Custom Modules")]),s._v("：自定义模块，如果核心模块无法满足需求，可通过各种编程语言（Shell，Python 或 GoLang 等）开发模块使用。")]),s._v(" "),a("li",[a("strong",[s._v("Plugins")]),s._v("：借助于插件完成记录日志、邮件等功能；")]),s._v(" "),a("li",[a("strong",[s._v("Playbook")]),s._v("：剧本，当执行多个任务时，可以对服务器角色及应用部署进行编排。")])]),s._v(" "),a("p",[a("strong",[s._v("实现原理：ansible 通过单个模块或者 playbook 转换成 python 程序经过 ssh 协议，推送到各个主机上")])]),s._v(" "),a("h1",{attrs:{id:"ansible-任务执行流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ansible-任务执行流程"}},[s._v("#")]),s._v(" Ansible 任务执行流程")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://muyids.oss-cn-beijing.aliyuncs.com/img/202205061503519.png",alt:"image-20220506150300148"}})]),s._v(" "),a("h1",{attrs:{id:"安装使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装使用"}},[s._v("#")]),s._v(" 安装使用")]),s._v(" "),a("h2",{attrs:{id:"前置要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前置要求"}},[s._v("#")]),s._v(" 前置要求")]),s._v(" "),a("p",[s._v("需要依赖 Python 环境")]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("在 master 主机上安装 ansible，以我本地的 mac 为例")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("brew "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ansible\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),a("p",[s._v("配置文件默认位置")]),s._v(" "),a("h1",{attrs:{id:"批量执行-shell-命令-最常用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#批量执行-shell-命令-最常用"}},[s._v("#")]),s._v(" 批量执行 shell 命令（最常用）")]),s._v(" "),a("p",[s._v('ansible -i /etc/ansible/hosts check17662042 -m shell -a "chmod 755 /var/log/messages"')]),s._v(" "),a("p",[a("strong",[s._v("批量杀掉远端服务器应用进程")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" shell "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"ps -ef | grep zabbix |grep -v grep |awk '{print \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}' | xargs kill -9\"")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);