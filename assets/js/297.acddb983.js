(window.webpackJsonp=window.webpackJsonp||[]).push([[297],{569:function(t,e,a){"use strict";a.r(e);var s=a(14),_=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[e("code",[t._v("influxdb")]),t._v("是目前比较流行的时间序列数据库。")]),t._v(" "),e("p",[e("em",[t._v("何谓时间序列数据库？")])]),t._v(" "),e("p",[t._v("什么是时间序列数据库，最简单的定义就是数据格式里包含 Timestamp 字段的数据，比如某一时间环境的温度，CPU 的使用率等。\n但是，有什么数据不包含 Timestamp 呢？几乎所有的数据其实都可以打上一个 Timestamp 字段。时间序列数据的更重要的一个属性是如何去查询它，包括数据的过滤，计算等等。")]),t._v(" "),e("h2",{attrs:{id:"influxdb"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#influxdb"}},[t._v("#")]),t._v(" Influxdb")]),t._v(" "),e("p",[t._v("Influxdb 是一个开源的分布式时序、时间和指标数据库，使用 go 语言编写，无需外部依赖。")]),t._v(" "),e("p",[t._v("它有三大特性：")]),t._v(" "),e("ul",[e("li",[t._v("时序性（Time Series）：与时间相关的函数的灵活使用（诸如最大、最小、求和等）；")]),t._v(" "),e("li",[t._v("度量（Metrics）：对实时大量数据进行计算；")]),t._v(" "),e("li",[t._v("事件（Event）：支持任意的事件数据，换句话说，任意事件的数据我们都可以做操作。")])]),t._v(" "),e("p",[t._v("同时，它有以下几大特点：")]),t._v(" "),e("ul",[e("li",[t._v("schemaless(无结构)，可以是任意数量的列；")]),t._v(" "),e("li",[t._v("min, max, sum, count, mean, median 一系列函数，方便统计；")]),t._v(" "),e("li",[t._v("Native HTTP API, 内置 http 支持，使用 http 读写；")]),t._v(" "),e("li",[t._v("Powerful Query Language 类似 sql；")]),t._v(" "),e("li",[t._v("Built-in Explorer 自带管理工具。")])]),t._v(" "),e("h2",{attrs:{id:"influxdb-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#influxdb-安装"}},[t._v("#")]),t._v(" Influxdb 安装")]),t._v(" "),e("p",[t._v("在讲解具体的安装步骤之前，先说说 influxdb 的两个 http 端口：8083 和 8086")]),t._v(" "),e("ul",[e("li",[t._v("port 8083：管理页面端口，访问 localhost:8083 可以进入你本机的 influxdb 管理页面；")]),t._v(" "),e("li",[t._v("port 8086：http 连接 influxdb client 端口，一般使用该端口往本机的 influxdb 读写数据。")])]),t._v(" "),e("h3",{attrs:{id:"os-x"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#os-x"}},[t._v("#")]),t._v(" OS X")]),t._v(" "),e("p",[t._v("brew update\nbrew install influxdb")]),t._v(" "),e("h3",{attrs:{id:"docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[t._v("#")]),t._v(" docker")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("docker run -d --restart=always \\\n\t -p 8083:8083 -e INFLUXDB_ADMIN_ENABLED=true \\\n\t -p 8086:8086 \\\n      -v /var/lib/influxdb:/var/lib/influxdb \\\n      influxdb\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("h3",{attrs:{id:"redhat-centos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redhat-centos"}},[t._v("#")]),t._v(" RedHat & CentOS")]),t._v(" "),e("p",[t._v("wget https://dl.influxdata.com/influxdb/releases/influxdb-1.0.2.x86_64.rpm\nsudo yum localinstall influxdb-1.0.2.x86_64.rpm\n安装完之后，如何启动呢？")]),t._v(" "),e("ul",[e("li",[t._v("sudo service influxdb start")]),t._v(" "),e("li",[t._v("/etc/init.d/influxdb restart\n如何在命令行使用")])]),t._v(" "),e("p",[t._v("安装完毕之后，如何在命令行使用呢？")]),t._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("influx\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("influx -precision rfc3339")]),t._v(" "),e("h2",{attrs:{id:"influxdb-基本操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#influxdb-基本操作"}},[t._v("#")]),t._v(" influxdb 基本操作")]),t._v(" "),e("p",[t._v("名词解释")]),t._v(" "),e("p",[t._v("在具体的讲解 influxdb 的相关操作之前先说说 influxdb 的一些专有名词，这些名词代表什么。")]),t._v(" "),e("p",[t._v("influxdb 相关名词")]),t._v(" "),e("ul",[e("li",[t._v("database：数据库；")]),t._v(" "),e("li",[t._v("measurement：数据库中的表；")]),t._v(" "),e("li",[t._v("points：表里面的一行数据。")])]),t._v(" "),e("p",[t._v("influxDB 中独有的一些概念")]),t._v(" "),e("p",[t._v("Point 由时间戳（time）、数据（field）和标签（tags）组成。")]),t._v(" "),e("ul",[e("li",[t._v("time：每条数据记录的时间，也是数据库自动生成的主索引；")]),t._v(" "),e("li",[t._v("fields：各种记录的值；")]),t._v(" "),e("li",[t._v("tags：各种有索引的属性。")])]),t._v(" "),e("p",[t._v("还有一个重要的名词：series")]),t._v(" "),e("p",[t._v("所有在数据库中的数据，都需要通过图表来表示，series 表示这个表里面的所有的数据可以在图标上画成几条线（注：线条的个数由 tags 排列组合计算出来）")]),t._v(" "),e("h3",{attrs:{id:"influxdb-基本操作-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#influxdb-基本操作-2"}},[t._v("#")]),t._v(" influxdb 基本操作")]),t._v(" "),e("p",[t._v("数据库与表的操作\n可以直接在 web 管理页面做操作，当然也可以命令行。")]),t._v(" "),e("h4",{attrs:{id:"创建数据库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建数据库"}},[t._v("#")]),t._v(" 创建数据库")]),t._v(" "),e("p",[t._v('create database "db_name"')]),t._v(" "),e("h4",{attrs:{id:"显示所有的数据库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#显示所有的数据库"}},[t._v("#")]),t._v(" 显示所有的数据库")]),t._v(" "),e("p",[t._v("show databases")]),t._v(" "),e("h4",{attrs:{id:"删除数据库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除数据库"}},[t._v("#")]),t._v(" 删除数据库")]),t._v(" "),e("p",[t._v('drop database "db_name"')]),t._v(" "),e("h4",{attrs:{id:"使用数据库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用数据库"}},[t._v("#")]),t._v(" 使用数据库")]),t._v(" "),e("p",[t._v("use db_name")]),t._v(" "),e("h4",{attrs:{id:"显示该数据库中所有的表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#显示该数据库中所有的表"}},[t._v("#")]),t._v(" 显示该数据库中所有的表")]),t._v(" "),e("p",[t._v("show measurements")]),t._v(" "),e("h4",{attrs:{id:"创建表-直接在插入数据的时候指定表名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建表-直接在插入数据的时候指定表名"}},[t._v("#")]),t._v(" 创建表，直接在插入数据的时候指定表名")]),t._v(" "),e("p",[t._v("insert test,host=127.0.0.1,monitor_name=test count=1")]),t._v(" "),e("h4",{attrs:{id:"删除表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除表"}},[t._v("#")]),t._v(" 删除表")]),t._v(" "),e("p",[t._v('drop measurement "measurement_name"')]),t._v(" "),e("h4",{attrs:{id:"增"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#增"}},[t._v("#")]),t._v(" 增")]),t._v(" "),e("p",[t._v("向数据库中插入数据。\n通过命令行")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("use testDb")])]),t._v(" "),e("li",[e("p",[t._v("insert test,host=127.0.0.1,monitor_name=test count=1\n通过 http 接口")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("curl -i -XPOST 'http://127.0.0.1:8086/write?db=testDb' --data-binary 'test,host=127.0.0.1,monitor_name=test count=1'\n")])])])])]),t._v(" "),e("p",[t._v("读者看到这里可能会观察到插入的数据的格式貌似比较奇怪，这是因为 influxDB 存储数据采用的是 Line Protocol 格式。那么何谓 Line Protoco 格式？")]),t._v(" "),e("p",[t._v("Line Protocol 格式：写入数据库的 Point 的固定格式。")]),t._v(" "),e("p",[t._v("在上面的两种插入数据的方法中都有这样的一部分：")]),t._v(" "),e("p",[t._v("test,host=127.0.0.1,monitor_name=test count=1")]),t._v(" "),e("p",[t._v("其中：")]),t._v(" "),e("ul",[e("li",[t._v("test：表名；")]),t._v(" "),e("li",[t._v("host=127.0.0.1,monitor_name=test：tag；")]),t._v(" "),e("li",[t._v("count=1：field")])]),t._v(" "),e("p",[t._v("想对此格式有详细的了解参见"),e("a",{attrs:{href:"https://docs.influxdata.com/influxdb/v1.6/write_protocols/line_protocol_tutorial/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),e("OutboundLink")],1)]),t._v(" "),e("h4",{attrs:{id:"查"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查"}},[t._v("#")]),t._v(" 查")]),t._v(" "),e("p",[t._v("查询数据库中的数据。")]),t._v(" "),e("p",[t._v('通过命令行\nselect _ from test order by time desc\n通过 http 接口\ncurl -G \'http://localhost:8086/query?pretty=true\' --data-urlencode "db=testDb" --data-urlencode "q=select _ from test order by time desc"\ninfluxDB 是支持类 sql 语句的，具体的查询语法都差不多，这里就不再做详细的赘述了。')]),t._v(" "),e("h4",{attrs:{id:"数据保存策略-retention-policies"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#数据保存策略-retention-policies"}},[t._v("#")]),t._v(" 数据保存策略（Retention Policies）")]),t._v(" "),e("p",[t._v("influxDB 是没有提供直接删除数据记录的方法，但是提供数据保存策略，主要用于指定数据保留时间，超过指定时间，就删除这部分数据。")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("查看当前数据库 Retention Policies")]),t._v(" "),e("p",[t._v('show retention policies on "db_name"')])]),t._v(" "),e("li",[e("p",[t._v('创建新的 Retention Policies\ncreate retention policy "rp_name" on "db_name" duration 3w replication 1 default')]),t._v(" "),e("ul",[e("li",[t._v("rp_name：策略名；")]),t._v(" "),e("li",[t._v("db_name：具体的数据库名；")]),t._v(" "),e("li",[t._v("3w：保存 3 周，3 周之前的数据将被删除，influxdb 具有各种事件参数，比如：h（小时），d（天），w（星期）；")]),t._v(" "),e("li",[t._v("replication 1：副本个数，一般为 1 就可以了；")]),t._v(" "),e("li",[t._v("default：设置为默认策略")])])]),t._v(" "),e("li",[e("p",[t._v('修改 Retention Policies\nalter retention policy "rp_name" on "db_name" duration 30d default')])]),t._v(" "),e("li",[e("p",[t._v('删除 Retention Policies\ndrop retention policy "rp_name"')])])]),t._v(" "),e("h4",{attrs:{id:"用户管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用户管理"}},[t._v("#")]),t._v(" 用户管理")]),t._v(" "),e("p",[t._v("可以直接在 web 管理页面做操作，也可以命令行。")]),t._v(" "),e("ul",[e("li",[t._v("显示用户\nshow users")]),t._v(" "),e("li",[t._v("创建用户\ncreate user \"username\" with password 'password'")]),t._v(" "),e("li",[t._v("创建管理员权限用户\ncreate user \"username\" with password 'password' with all privileges")]),t._v(" "),e("li",[t._v('删除用户\ndrop user "username"')])])])}),[],!1,null,null,null);e.default=_.exports}}]);