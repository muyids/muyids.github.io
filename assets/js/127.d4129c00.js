(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{400:function(n,s,a){"use strict";a.r(s);var t=a(14),e=Object(t.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("p",[n._v("Go 语言实现了"),s("code",[n._v("CSP（通信顺序进程）模型")]),n._v("来作为"),s("code",[n._v("goroutine")]),n._v("间的推荐通信方式")]),n._v(" "),s("h2",{attrs:{id:"并发和并行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#并发和并行"}},[n._v("#")]),n._v(" 并发和并行")]),n._v(" "),s("ul",[s("li",[n._v("并发：同一时间内执行多个任务")]),n._v(" "),s("li",[n._v("并行：同一"),s("strong",[n._v("时刻")]),n._v("执行多个任务\nGo 语言的并发通过 goroutine 实现。goroutine 类似于线程，属于用户态的线程。操作系统的线程属于内核级的线程。")])]),n._v(" "),s("p",[n._v("我们可以根据需要创建成千上万个 goroutine 并发工作。")]),n._v(" "),s("h2",{attrs:{id:"golang-的-csp-并发模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#golang-的-csp-并发模型"}},[n._v("#")]),n._v(" golang 的 CSP 并发模型")]),n._v(" "),s("p",[n._v("CSP（Communicating Sequential Process）并发模型，中文可以叫做"),s("strong",[n._v("通信顺序进程")])]),n._v(" "),s("p",[n._v("CSP 模型由并发执行的实体（线程或者进程）所组成，实体之间通过发送消息进行通信，\n这里发送消息时使用的就是通道，或者叫 channel\n请记住下面这句话：\nDo not communicate by sharing memory; instead, share memory by communicating.\n"),s("strong",[n._v("不要以共享内存的方式来通信，相反，要通过通信来共享内存。")])]),n._v(" "),s("p",[n._v("普通的线程并发模型，就是像 Java、C++、或者 Python，他们线程间通信都是通过共享内存的方式来进行的。")]),n._v(" "),s("p",[n._v("非常典型的方式就是，在访问共享数据（例如数组、Map、或者某个结构体或对象）的时候，通过锁来访问，\n因此，在很多时候，衍生出一种方便操作的数据结构，叫做"),s("strong",[n._v("线程安全的数据结构")]),n._v("\n例如 Java 提供的包”java.util.concurrent”中的数据结构。Go 中也实现了传统的线程并发模型。")]),n._v(" "),s("p",[n._v("Go 的 CSP 并发模型，是通过"),s("strong",[n._v("goroutine 和 channel")]),n._v("来实现的。")]),n._v(" "),s("p",[n._v("goroutine 是 Go 语言中并发的执行单位。\nchannel 是 Go 语言中各个并发结构体(goroutine)之前的通信机制。\n通俗的讲，就是各个 goroutine 之间通信的”管道“，有点类似于 Linux 中的管道。")]),n._v(" "),s("h2",{attrs:{id:"goroutine"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#goroutine"}},[n._v("#")]),n._v(" goroutine")]),n._v(" "),s("p",[n._v("go 语言中使用 goroutine 非常简单，只需要在函数前面加上 go 关键字")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('var wg sync.WaitGroup\nfunc say(s string, i int) {\n\tfmt.Println(s, i)\n\twg.Done()\n}\nfunc main() {\n\tfor i := 0; i < 1000; i++ {\n\t\twg.Add(1)\n\t\t//go say("hello", i)\n\t\tgo func(i int) {\n\t\t\tfmt.Println(i)\n\t\t\twg.Done()\n\t\t}(i)\n\t}\n\n\twg.Wait()\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br")])]),s("p",[s("strong",[n._v("可增长的栈")])]),n._v(" "),s("p",[n._v("OS 线程（操作系统线程）一般都有固定的栈空间（通常为 2MB）")]),n._v(" "),s("p",[n._v("goroutine 初始状态为 2kb, 可以增长到 1G")]),n._v(" "),s("p",[s("code",[n._v("runtime.GOMAXPROCS(4)")]),n._v(" // 设置用几个 cpu 运行代码")]),n._v(" "),s("h2",{attrs:{id:"channel"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#channel"}},[n._v("#")]),n._v(" channel")]),n._v(" "),s("p",[n._v("go 的并发模型是 CSP（Communicating Sequential Processes），提倡"),s("strong",[n._v("通过通信共享内存，而不是通过共享内存而实现通信")])]),n._v(" "),s("p",[n._v("goroutine 是 go 程序并发的执行体，channel 是他们之间的连接")]),n._v(" "),s("p",[n._v("channel 是可以让一个 goroutine 发送特定值到另一个 goroutine 的通信机制")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("var ch1 chan int // 声明一个传递整型的通道\nch1 = make(chan int, 1)\nch1 <- 10 // 发送\nx := <-ch1 // 接收\nclose(ch1) // 关闭通道\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br")])]),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("ch1 = make(chan int, 1) // 带缓冲区通道\nch2 = make(chan int) // 无缓冲区通道，又称为同步通道\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br")])]),s("h2",{attrs:{id:"goroutine-channel-协同工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#goroutine-channel-协同工作"}},[n._v("#")]),n._v(" goroutine + channel 协同工作")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("func producer(ch chan int) {\n\tfor i := 0; i < 100; i++ {\n\t\tch <- i\n\t}\n\tclose(ch)\n}\n\nfunc consumer(ch1 chan int, ch2 chan int) {\n\t// 从通道中取值的方式1\n\tfor {\n\t\tvalue, ok := <-ch1\n\t\tif !ok {\n\t\t\tbreak\n\t\t}\n\t\tch2 <- value * value\n\t}\n\tclose(ch2)\n}\n\nfunc main() {\n\tch1 := make(chan int, 100)\n\tch2 := make(chan int, 100)\n\tgo producer(ch1)\n\tgo consumer(ch1, ch2)\n\n\t// 从通道中取值的方式2\n\tfor ret := range ch2 {\n\t\tfmt.Println(ret)\n\t}\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br")])]),s("p",[s("strong",[n._v("select 多路复用")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("select {\n\tcase <-ch1:\n\t\tbreak\n\tcase <-ch2:\n\t\tbreak\n\tdefault:\n        // 默认操作\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);