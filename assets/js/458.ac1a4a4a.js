(window.webpackJsonp=window.webpackJsonp||[]).push([[458],{732:function(t,v,_){"use strict";_.r(v);var a=_(14),e=Object(a.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"strace-命令介绍"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#strace-命令介绍"}},[t._v("#")]),t._v(" Strace 命令介绍")]),t._v(" "),v("p",[t._v("可用于诊断、调试和教学的 Linux 用户空间跟踪器。")]),t._v(" "),v("p",[t._v("用他来监控用户空间进程 和 内核 的交互，比如系统调用、信号传递、进程状态变更等。")]),t._v(" "),v("h1",{attrs:{id:"常用选项"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#常用选项"}},[t._v("#")]),t._v(" 常用选项")]),t._v(" "),v("p",[t._v("从一个示例命令来看：")]),t._v(" "),v("div",{staticClass:"language-shell line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-shell"}},[v("code",[v("span",{pre:!0,attrs:{class:"token function"}},[t._v("strace")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-tt")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-T")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("trace")]),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("file "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /data/log/strace.log "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[t._v("23489")]),t._v("\n")])]),t._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[t._v("1")]),v("br")])]),v("ul",[v("li",[t._v("-tt : 每行输出的前面，显示毫秒级的时间")]),t._v(" "),v("li",[t._v("-T 显示每次系统调用所花费的时间")]),t._v(" "),v("li",[t._v("-v 对于某些相关调用，把完整的画境变量，文件 stat 结构等打印出来")]),t._v(" "),v("li",[t._v("-f 最终目标进程，以及 目标进程 创建的所有子进程")]),t._v(" "),v("li",[t._v("-e 控制要跟踪的事件 和 跟踪行为，比如指定要跟踪的 系统调用名称")]),t._v(" "),v("li",[t._v("-o 把 strace 的输出单独写到 指定的文件")]),t._v(" "),v("li",[t._v("-s 当系统调用的某个参数是字符串时，最多输出指定长度的内容，默认是 32 个字节")]),t._v(" "),v("li",[t._v("-p 指定要跟踪的进程 pid， 要同时跟踪多个 pid，重复多次 -p 选项即可")])]),t._v(" "),v("h1",{attrs:{id:"系统调用函数分类说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#系统调用函数分类说明"}},[t._v("#")]),t._v(" 系统调用函数分类说明")]),t._v(" "),v("h2",{attrs:{id:"进程管理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#进程管理"}},[t._v("#")]),t._v(" 进程管理")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("函数名")]),t._v(" "),v("th",[t._v("说明")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("fork")]),t._v(" "),v("td",[t._v("创建一个新进程")])]),t._v(" "),v("tr",[v("td",[t._v("clone")]),t._v(" "),v("td",[t._v("按指定条件创建子进程")])]),t._v(" "),v("tr",[v("td",[t._v("execve")]),t._v(" "),v("td",[t._v("运行可执行文件")])]),t._v(" "),v("tr",[v("td",[t._v("pause")]),t._v(" "),v("td",[t._v("进程将处于阻塞状态")])]),t._v(" "),v("tr",[v("td",[t._v("wait")]),t._v(" "),v("td",[t._v("等待子进程终止")])]),t._v(" "),v("tr",[v("td",[t._v("waitpid")]),t._v(" "),v("td",[t._v("等待指定子进程终止")])]),t._v(" "),v("tr",[v("td"),t._v(" "),v("td")])])]),t._v(" "),v("h2",{attrs:{id:"文件和设备访问"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#文件和设备访问"}},[t._v("#")]),t._v(" 文件和设备访问")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("函数名")]),t._v(" "),v("th",[t._v("说明")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("open")]),t._v(" "),v("td",[t._v("打开文件")])]),t._v(" "),v("tr",[v("td",[t._v("creat")]),t._v(" "),v("td",[t._v("创建新文件")])]),t._v(" "),v("tr",[v("td",[t._v("close")]),t._v(" "),v("td",[t._v("关闭文件描述符")])]),t._v(" "),v("tr",[v("td",[t._v("read")]),t._v(" "),v("td",[t._v("读文件")])]),t._v(" "),v("tr",[v("td",[t._v("write")]),t._v(" "),v("td",[t._v("写文件")])]),t._v(" "),v("tr",[v("td",[t._v("pread")]),t._v(" "),v("td",[t._v("对文件随机读")])]),t._v(" "),v("tr",[v("td",[t._v("pwrite")]),t._v(" "),v("td",[t._v("对文件随机写")])]),t._v(" "),v("tr",[v("td",[t._v("poll")]),t._v(" "),v("td",[t._v("I/O 多路转换")])]),t._v(" "),v("tr",[v("td",[t._v("truncate")]),t._v(" "),v("td",[t._v("截断文件")])])])]),t._v(" "),v("h2",{attrs:{id:"文件系统操作"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#文件系统操作"}},[t._v("#")]),t._v(" 文件系统操作")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("函数名")]),t._v(" "),v("th",[t._v("说明")]),t._v(" "),v("th")])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("access")]),t._v(" "),v("td",[t._v("确定文件的可存取性")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("Chmod")]),t._v(" "),v("td",[t._v("确定文件的可存取性")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("Chown")]),t._v(" "),v("td",[t._v("改变文件的属主或用户组")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("chroot")]),t._v(" "),v("td",[t._v("改变根目录")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("stat")]),t._v(" "),v("td",[t._v("获取文件状态信息")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("lstat")]),t._v(" "),v("td",[t._v("获取文件状态信息")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("Getdents")]),t._v(" "),v("td",[t._v("读取目录项")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("mkdir")]),t._v(" "),v("td",[t._v("创建目录")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("link")]),t._v(" "),v("td",[t._v("创建链接")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("fcntl")]),t._v(" "),v("td",[t._v("用来管理文件描述符")]),t._v(" "),v("td",[t._v("https://blog.csdn.net/rikeyone/article/details/88828154")])])])]),t._v(" "),v("h2",{attrs:{id:"内存管理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#内存管理"}},[t._v("#")]),t._v(" 内存管理")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("函数名")]),t._v(" "),v("th",[t._v("说明")]),t._v(" "),v("th",[t._v("说明")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("mmap")]),t._v(" "),v("td",[t._v("映射虚拟内存页")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("sync")]),t._v(" "),v("td",[t._v("将内存缓冲区数据写回硬盘")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("Brk/sbrk")]),t._v(" "),v("td",[t._v("brk 机制，mmap 主要控制虚拟空间 mmap 区域管理，而 brk 机制主要管理的是一个进行的堆空间。")]),t._v(" "),v("td",[t._v("https://blog.csdn.net/weixin_42730667/article/details/121113433")])])])]),t._v(" "),v("h2",{attrs:{id:"socket-控制"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#socket-控制"}},[t._v("#")]),t._v(" socket 控制")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("函数名")]),t._v(" "),v("th",[t._v("说明")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("Socketcall")]),t._v(" "),v("td",[t._v("socket 系统调用")])]),t._v(" "),v("tr",[v("td",[t._v("Socket")]),t._v(" "),v("td",[t._v("建立 socket")])]),t._v(" "),v("tr",[v("td",[t._v("bind")]),t._v(" "),v("td",[t._v("绑定 socket 到端口")])]),t._v(" "),v("tr",[v("td",[t._v("connect")]),t._v(" "),v("td",[t._v("连接远程主机")])]),t._v(" "),v("tr",[v("td",[t._v("send")]),t._v(" "),v("td",[t._v("通过 socket 发送信息")])]),t._v(" "),v("tr",[v("td",[t._v("sendto")]),t._v(" "),v("td",[t._v("发送 UDP 信息")])]),t._v(" "),v("tr",[v("td",[t._v("sendmsg")]),t._v(" "),v("td",[t._v("参见 send")])]),t._v(" "),v("tr",[v("td",[t._v("listen")]),t._v(" "),v("td",[t._v("监听 socket 端口")])]),t._v(" "),v("tr",[v("td",[t._v("select")]),t._v(" "),v("td",[t._v("对多路同步 I/O 进行轮询")])]),t._v(" "),v("tr",[v("td"),t._v(" "),v("td")])])]),t._v(" "),v("h1",{attrs:{id:"故障案例一"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#故障案例一"}},[t._v("#")]),t._v(" 故障案例一")]),t._v(" "),v("p",[t._v("调试")]),t._v(" "),v("p",[t._v("strace -e open,openat -ff -s 1023 -tt ./console plugin:activate ExtraTools 2>&1 | tee b.log")]),t._v(" "),v("p",[t._v("strace -ff -s 1023 -tt ./console plugin:deactivate ExtraTools 2>&1 | tee b.log")]),t._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("strace -o output.txt -T -tt -e trace=all -p 28979\n")])]),t._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[t._v("1")]),v("br")])])])}),[],!1,null,null,null);v.default=e.exports}}]);