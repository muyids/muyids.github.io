(window.webpackJsonp=window.webpackJsonp||[]).push([[224],{497:function(t,s,a){"use strict";a.r(s);var r=a(14),n=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"spring-cloud-stream"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-stream"}},[t._v("#")]),t._v(" Spring Cloud Stream")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("现在一个很项目可能分为三部分"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n\t\t\t前端"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("后端"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("大数据\n\t\t\t而后端开发使用消息中间件"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("可能会使用"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RabbitMq")]),t._v("\n\t\t\t而大数据开发"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("一般都是使用"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Kafka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t那么一个项目中有多个消息中间件"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("对于程序员"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("因为人员都不友好\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("而 Spring Cloud Stream 就类似 jpa,屏蔽底层消息中间件的差异,程序员主要操作 Spring Cloud Stream 即可")]),t._v(" "),s("p",[t._v("​ 不需要管底层是 kafka 还是 rabbitMq")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%841.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"什么是-spring-cloud-stream"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-spring-cloud-stream"}},[t._v("#")]),t._v(" ==什么是 Spring Cloud Stream==")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%842.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%843.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%844.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%845.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"spring-cloud-stream-是怎么屏蔽底层差异的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-stream-是怎么屏蔽底层差异的"}},[t._v("#")]),t._v(" =="),s("strong",[t._v("Spring Cloud Stream 是怎么屏蔽底层差异的?")]),t._v("==")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%846.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("绑定器:")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%847.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%848.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%849.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"spring-cloud-streamd-通信模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-streamd-通信模式"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Spring Cloud Streamd 通信模式:")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8410.png",alt:""}}),s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8411.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"spring-cloud-stream-的业务流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-stream-的业务流程"}},[t._v("#")]),t._v(" Spring Cloud Stream 的业务流程:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8412.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8414.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8413.png",alt:""}})]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("类似flume中的channel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sink  估计是借鉴"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("抄袭"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("的\n  \tsource用于获取数据"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("要发送到mq的数据"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  \tchannel类似"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringCloudStream")]),t._v("中的中间件"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("用于存放source接收到的数据"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("或者是存放binder拉取的数据\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("h3",{attrs:{id:"常用注解和-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用注解和-api"}},[t._v("#")]),t._v(" 常用注解和 api:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8415.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"使用-springcloudstream"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-springcloudstream"}},[t._v("#")]),t._v(" 使用 SpringCloudStream:")]),t._v(" "),s("p",[t._v("需要创建三个项目,一个生产者,两个消费者")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8416.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_1-创建生产者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建生产者"}},[t._v("#")]),t._v(" 1,创建生产者")]),t._v(" "),s("h4",{attrs:{id:"_1-pom"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-pom"}},[t._v("#")]),t._v(" 1,pom")]),t._v(" "),s("h4",{attrs:{id:"_2-配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件"}},[t._v("#")]),t._v(" 2,配置文件")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8417",alt:"image-20200415114816133"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8418.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"_3-主启动类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-主启动类"}},[t._v("#")]),t._v(" 3,主启动类")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8419.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"_4-service-和实现类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-service-和实现类"}},[t._v("#")]),t._v(" 4,service 和实现类")]),t._v(" "),s("p",[t._v("service 定义发送消息")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8420.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8421.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("这里,就会调用 send 方法,将消息发送给 channel,")])]),t._v(" "),s("p",[t._v("​ "),s("strong",[t._v("然后 channel 将消费发送给 binder,然后发送到 rabbitmq 中")])]),t._v(" "),s("h4",{attrs:{id:"_5-controller"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-controller"}},[t._v("#")]),t._v(" 5,controller")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8422.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"_6-可以测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-可以测试"}},[t._v("#")]),t._v(" 6,可以测试")]),t._v(" "),s("p",[s("strong",[t._v("启动 rabbitmq")])]),t._v(" "),s("p",[s("strong",[t._v("启动 7001,8801")])]),t._v(" "),s("p",[t._v("​ 确定 8801 后,会在 rabbitmq 中创建一个 Exchange,就是我们配置文件中配置的 exchange")]),t._v(" "),s("p",[s("strong",[t._v("访问 8801 的/sendMessage")])]),t._v(" "),s("h3",{attrs:{id:"创建消费者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建消费者"}},[t._v("#")]),t._v(" 创建消费者:")]),t._v(" "),s("h4",{attrs:{id:"_1-pom-文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-pom-文件"}},[t._v("#")]),t._v(" 1,pom 文件")]),t._v(" "),s("h4",{attrs:{id:"_2-配置文件-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件-2"}},[t._v("#")]),t._v(" 2,配置文件")]),t._v(" "),s("p",[t._v("=="),s("strong",[t._v("这里排版一点问题")]),t._v("==")]),t._v(" "),s("p",[s("strong",[t._v("==input==就表示,当前服务是一个消费者,需要消费消息,下面就是指定消费哪个 Exchange 中的消息")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8423.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8424.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"_3-主启动类-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-主启动类-2"}},[t._v("#")]),t._v(" 3,主启动类")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8425.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"_4-业务类-消费数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-业务类-消费数据"}},[t._v("#")]),t._v(" 4,业务类(消费数据)")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8426.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("生产者发送消息时,使用 send 方法发送,send 方法发送的是一个个 Message,里面封装了数据")])]),t._v(" "),s("h4",{attrs:{id:"_5-测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-测试"}},[t._v("#")]),t._v(" 5,测试:")]),t._v(" "),s("p",[t._v("启动 7001.8801.8802")]),t._v(" "),s("p",[s("strong",[t._v("此时使用生产者生产消息")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8427.png",alt:""}})]),t._v(" "),s("p",[t._v("==可以看到,消费者已经接收到消息了==")]),t._v(" "),s("h3",{attrs:{id:"创建消费者-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建消费者-2"}},[t._v("#")]),t._v(" 创建消费者 2")]),t._v(" "),s("p",[t._v("创建 8803,")]),t._v(" "),s("p",[t._v("==与 8802 创建一模一样,就不写了==")]),t._v(" "),s("p",[s("strong",[t._v("创建 8803 主要是为了演示重复消费等问题")])]),t._v(" "),s("p",[t._v("...")]),t._v(" "),s("p",[t._v("....")]),t._v(" "),s("p",[t._v("...")]),t._v(" "),s("h3",{attrs:{id:"重复消费问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重复消费问题"}},[t._v("#")]),t._v(" ==重复消费问题:==")]),t._v(" "),s("p",[t._v("此时启动 7001.8801.8802.8803")]),t._v(" "),s("p",[t._v("此时生产者生产一条消息")]),t._v(" "),s("p",[t._v("但是此时查询消费者,发现 8802,8803==都消费到了同一条数据==")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8428.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8429.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"_1-自定义分组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-自定义分组"}},[t._v("#")]),t._v(" 1,自定义分组")]),t._v(" "),s("p",[s("strong",[t._v("修改 8802,8803 的配置文件")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8430.png",alt:""}})]),t._v(" "),s("p",[t._v("![](https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream的31 - 副本.png)")]),t._v(" "),s("p",[s("strong",[t._v("现在将 8802,8803 都分到了 A 组")])]),t._v(" "),s("p",[t._v("然后去重启 02,03")]),t._v(" "),s("p",[s("strong",[t._v("然后此时生产者生产两条消息")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8433.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8434.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/SpringCloudStream%E7%9A%8435.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("可以看到,每人只消费了一条消息,并且没有重复消费")])]),t._v(" "),s("h3",{attrs:{id:"持久化问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#持久化问题"}},[t._v("#")]),t._v(" 持久化问题:")]),t._v(" "),s("p",[t._v("就是当服务挂了,怎么消费没有消费的数据??")]),t._v(" "),s("p",[t._v("这里,先将 8802 移除 A 组,")]),t._v(" "),s("p",[t._v("​ 然后将 02,03 服务关闭")]),t._v(" "),s("p",[t._v("此时生产者开启,发送 3 条消息")]),t._v(" "),s("p",[t._v("​ 此时重启 02,03")]),t._v(" "),s("p",[t._v("​ 可以看到,当 02 退出 A 组后,它就获取不到在它宕机的时间段内的数据")]),t._v(" "),s("p",[t._v("​ 但是 03 重启后,直接获取到了宕机期间它没有消费的数据,并且消费了")]),t._v(" "),s("p",[t._v("总结:\n也就是,当我们没有配置分组时,会出现消息漏消费的问题")])])}),[],!1,null,null,null);s.default=n.exports}}]);