(window.webpackJsonp=window.webpackJsonp||[]).push([[290],{564:function(s,a,e){"use strict";e.r(a);var t=e(14),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"慢查询分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#慢查询分析"}},[s._v("#")]),s._v(" 慢查询分析")]),s._v(" "),a("p",[s._v("所谓慢查询分析，就是查找执行时间长的 sql")]),s._v(" "),a("h2",{attrs:{id:"show-profiles"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#show-profiles"}},[s._v("#")]),s._v(" show profiles")]),s._v(" "),a("p",[s._v("show profiles 是 mysql 提供可以用来分析当前会话中语句执行的资源消耗情 况。可以用来 SQL 的调优测量。")]),s._v(" "),a("h2",{attrs:{id:"设置-mysql-支持-profile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置-mysql-支持-profile"}},[s._v("#")]),s._v(" 设置 MySQL 支持 profile")]),s._v(" "),a("h3",{attrs:{id:"查看是否支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看是否支持"}},[s._v("#")]),s._v(" 查看是否支持")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select @@have_profiling\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("结果为 YES，代表支持。")]),s._v(" "),a("h3",{attrs:{id:"查看是否开启-profiling-默认是关闭的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看是否开启-profiling-默认是关闭的"}},[s._v("#")]),s._v(" 查看是否开启 Profiling （默认是关闭的）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select @@profiling\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("结果为 0，代表没有开启")]),s._v(" "),a("h3",{attrs:{id:"开启-profiling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启-profiling"}},[s._v("#")]),s._v(" 开启 profiling")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("set profiling=1;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"使用-show-profiles-查看-sql-执行时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-show-profiles-查看-sql-执行时间"}},[s._v("#")]),s._v(" 使用 show profiles 查看 sql 执行时间")]),s._v(" "),a("p",[a("code",[s._v("show profiles")]),s._v(" 的生命周期的 client 的 连接；")]),s._v(" "),a("p",[s._v("当我们使用 "),a("code",[s._v("set profiling = 1;")]),s._v(" 时，此链接就可以 使用 "),a("code",[s._v("show profiles")]),s._v(" 查看 sql 执行时间")]),s._v(" "),a("h3",{attrs:{id:"查看每一条-sql-执行时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看每一条-sql-执行时间"}},[s._v("#")]),s._v(" 查看每一条 SQL 执行时间")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("show profiles;    //如果执行没有反应，查看profiling是否开启了，命令为select @@profiling;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"查询一条-sql-每个阶段执行时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询一条-sql-每个阶段执行时间"}},[s._v("#")]),s._v(" 查询一条 sql 每个阶段执行时间")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("show profile for query 6;   //6,代表Query_ID\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以看到每个阶段的执行时间")]),s._v(" "),a("h3",{attrs:{id:"查看线程在什么资源上耗费过高-类型-all、cpu、block-io-、context、switch、page-faults"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看线程在什么资源上耗费过高-类型-all、cpu、block-io-、context、switch、page-faults"}},[s._v("#")]),s._v(" 查看线程在什么资源上耗费过高 (类型 all、cpu、block io 、context、switch、page faults)")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("show profile cpu for query 7;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT * FROM INFORMATION_SCHEMA.PROFILING WHERE QUERY_ID=6;   //6,代表Query_ID\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);