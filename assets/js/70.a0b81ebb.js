(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{344:function(s,a,e){"use strict";e.r(a);var t=e(14),n=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("RESTful API")]),s._v(" "),a("ul",[a("li",[s._v("创建非结构化索引")]),s._v(" "),a("li",[s._v("插入数据")]),s._v(" "),a("li",[s._v("更新数据")])]),s._v(" "),a("h4",{attrs:{id:"restful-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#restful-api"}},[s._v("#")]),s._v(" RESTful API")]),s._v(" "),a("p",[s._v("在 Elasticsearch 中，提供了功能丰富的 RESTful API 的操作，包括基本的 CRUD、创建索引、删除索引等操作。")]),s._v(" "),a("h4",{attrs:{id:"获取所有索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取所有索引"}},[s._v("#")]),s._v(" 获取所有索引")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("GET /_cat/indices\n{\n\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"创建非结构化索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建非结构化索引"}},[s._v("#")]),s._v(" 创建非结构化索引")]),s._v(" "),a("p",[s._v("在 Lucene 中，创建索引是需要定义字段名称以及字段的类型的，在 Elasticsearch 中提供了非结构化的索引，就是不\n需要创建索引结构，即可写入数据到索引中，实际上在 Elasticsearch 底层会进行结构化操作，此操作对用户是透明\n的。")]),s._v(" "),a("p",[s._v("创建空索引：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('PUT: http://129.0.4.37:9200/test\n{\n    "settings": {\n        "index": {\n            "number_of_shards": "5",\n            "number_of_replicas": "1"\n        }\n    }\n}\n#删除索引\n\nDELETE /test\n\n{ "acknowledged": true }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h4",{attrs:{id:"插入数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插入数据"}},[s._v("#")]),s._v(" 插入数据")]),s._v(" "),a("blockquote",[a("p",[s._v("URL 规则：\nPOST /{索引}/{类型}/{id}")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /haoke/user/1001\n#数据\n{ "id":1001, "name":"张三", "age":20, "sex":"男" }\n#响应\n\n{ "_index": "haoke", "_type": "user", "_id": "1", "_version": 1, "result": "created", "_shards": { "total": 1, "successful": 1, "failed": 0 },"_seq_no": 0, "_primary_term": 1 }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("说明：")]),s._v(" "),a("ul",[a("li",[s._v("非结构化的索引，不需要事先创建，直接插入数据默认创建索引。")]),s._v(" "),a("li",[s._v("指定 id 插入数据，使用 id 作为_id；不指定 id 插入数据：自动生成_id")])]),s._v(" "),a("h4",{attrs:{id:"更新数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新数据"}},[s._v("#")]),s._v(" 更新数据")]),s._v(" "),a("p",[s._v("在 Elasticsearch 中，文档数据是不被修改的，但是可以通过覆盖的方式进行更新。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('PUT /haoke/user/1001\n{ "id":1001, "name":"张三", "age":21, "sex":"女" }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("问题：es 可以局部更新吗？ -- 可以的。")]),s._v(" "),a("p",[s._v("前面不是说，文档数据不能更新吗？ 其实是这样的：\n在内部，依然会查询到这个文档数据，然后进行覆盖操作，步骤如下：")]),s._v(" "),a("ol",[a("li",[s._v("从旧文档中检索 JSON")]),s._v(" "),a("li",[s._v("修改它")]),s._v(" "),a("li",[s._v("删除旧文档")]),s._v(" "),a("li",[s._v("索引新文档\n示例：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#注意：这里多了_update标识\nPOST /haoke/user/1001/_update\n\n{"doc":{ "age":23 } }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"删除数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除数据"}},[s._v("#")]),s._v(" 删除数据")]),s._v(" "),a("p",[s._v("在 Elasticsearch 中，删除文档数据，只需要发起 DELETE 请求即可。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("DELETE /haoke/user/1001\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("需要注意的是，result 表示已经删除，version 也增加了。\n如果删除一条不存在的数据，会响应 404：\n说明：")]),s._v(" "),a("p",[s._v("删除一个文档也不会立即从磁盘上移除，它只是被标记成已删除。Elasticsearch 将会在你之后添加更多索引的\n时候才会在后台进行删除内容的清理。")]),s._v(" "),a("h4",{attrs:{id:"搜索数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搜索数据"}},[s._v("#")]),s._v(" 搜索数据")]),s._v(" "),a("h4",{attrs:{id:"根据-id-搜索数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#根据-id-搜索数据"}},[s._v("#")]),s._v(" 根据 id 搜索数据")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("GET /haoke/user/BbPe_WcB9cFOnF3uebvr\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"搜索全部数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搜索全部数据"}},[s._v("#")]),s._v(" 搜索全部数据")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("GET /haoke/user/_search\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("默认返回 10 条数据")]),s._v(" "),a("h4",{attrs:{id:"关键字搜素数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关键字搜素数据"}},[s._v("#")]),s._v(" 关键字搜素数据")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#查询年龄等于20的用户\nGET /haoke/user/_search?q=age:20\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"dsl-搜索"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dsl-搜索"}},[s._v("#")]),s._v(" DSL 搜索")]),s._v(" "),a("p",[s._v("Elasticsearch 提供丰富且灵活的查询语言叫做"),a("strong",[s._v("DSL 查询(Query DSL)")]),s._v(",它允许你构建更加复杂、强大的查询。\n**DSL(Domain Specific Language 特定领域语言)**以 JSON 请求体的形式出现。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('POST /haoke/user/_search\n#请求体\n\n{ "query" : { "match" : { "age" : 20 } } }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);