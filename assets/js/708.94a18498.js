(window.webpackJsonp=window.webpackJsonp||[]).push([[708],{982:function(a,s,t){"use strict";t.r(s);var n=t(14),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"设计一个榜单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设计一个榜单"}},[a._v("#")]),a._v(" 设计一个榜单")]),a._v(" "),s("p",[a._v("基于 redis 有序集合实现")]),a._v(" "),s("p",[a._v("用到的 API")]),a._v(" "),s("ul",[s("li",[a._v("zincrby")]),a._v(" "),s("li",[a._v("zrevrangewithscores\n多个榜单集成")])]),a._v(" "),s("p",[a._v("zunionstore")]),a._v(" "),s("h2",{attrs:{id:"设计一个类微博"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设计一个类微博"}},[a._v("#")]),a._v(" 设计一个类微博")]),a._v(" "),s("h2",{attrs:{id:"设计一个聊天系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设计一个聊天系统"}},[a._v("#")]),a._v(" 设计一个聊天系统")]),a._v(" "),s("h2",{attrs:{id:"设计一个推送系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设计一个推送系统"}},[a._v("#")]),a._v(" 设计一个推送系统")]),a._v(" "),s("p",[a._v("题目：一个推送场景，50 条内容，定时推送，先推 5%用户，\n一段时间后再找出效果最好的几条，推给所有用户。\n设计相关库表，系统模块, 需要可以落地，有伪代码")]),a._v(" "),s("hr"),a._v(" "),s("p",[a._v("表结构")]),a._v(" "),s("p",[a._v("推送消息表 twitter")]),a._v(" "),s("p",[a._v('{\n"msg_id": "", // unique index\n""')]),a._v(" "),s("p",[a._v("}")]),a._v(" "),s("h2",{attrs:{id:"设计一个股票撮合交易系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设计一个股票撮合交易系统"}},[a._v("#")]),a._v(" 设计一个股票撮合交易系统")]),a._v(" "),s("p",[a._v("最核心的一定是挂单交易核心模块 - 撮合交易")]),a._v(" "),s("p",[a._v("撮合交易的规则：")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("买入价（A）必须大于或等于卖出价（B），即 A>=B。")])]),a._v(" "),s("li",[s("p",[a._v("按价格优先、时间优先的原则进行。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("当买入价大于卖出价时成交价应该如何确定？")])]),a._v(" "),s("p",[a._v("计算机在撮合时实际上是依据前一笔成交价而定出最新成交价的。如果前一笔成交价低于或等于卖出价，则最新成交价就是卖出价；如果前一笔成交价高于或等于买入价，则最新成交价就是买入价；如果前一笔成交价在卖出价与买入价之间，则最新成交价就是前一笔的成交价。下面不妨以例明之。")]),a._v(" "),s("p",[a._v("买方出价 1399 点，卖方出价是 1397 点。如果前一笔成交价为 1397 或 1397 点以下，最新成交价就是 1397 点；如果前一笔成交价为 1399 或 1399 点以上，则最新成交价就是 1399 点；如果前一笔成交价是 1398 点，则最新成交价就是 1398 点。")])])]),a._v(" "),s("p",[s("strong",[a._v("保证撮合交易在高并发场景下的稳定性")])]),a._v(" "),s("h2",{attrs:{id:"设计一个秒杀系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设计一个秒杀系统"}},[a._v("#")]),a._v(" 设计一个秒杀系统")]),a._v(" "),s("h3",{attrs:{id:"需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[a._v("#")]),a._v(" 需求")]),a._v(" "),s("p",[a._v("设计一个秒杀系统，支持百万级用户秒杀，不能超卖")]),a._v(" "),s("h3",{attrs:{id:"业务处理流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#业务处理流程"}},[a._v("#")]),a._v(" 业务处理流程")]),a._v(" "),s("p",[a._v("正常的一个业务处理流程")]),a._v(" "),s("ul",[s("li",[a._v("用户下单，生成订单")]),a._v(" "),s("li",[a._v("库存系统减库存")])]),a._v(" "),s("h3",{attrs:{id:"并发问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#并发问题"}},[a._v("#")]),a._v(" 并发问题")]),a._v(" "),s("h4",{attrs:{id:"前端限流"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端限流"}},[a._v("#")]),a._v(" 前端限流")]),a._v(" "),s("p",[a._v("网关层直接过滤掉 90%的请求")]),a._v(" "),s("h4",{attrs:{id:"优化缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化缓存"}},[a._v("#")]),a._v(" 优化缓存")]),a._v(" "),s("p",[a._v("查询库存时使用缓存；\n系统启动初始化时，同步数据库的库存到缓存；\n下单后，数据库减少成功后，同步缓存；")]),a._v(" "),s("h4",{attrs:{id:"优化数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化数据库"}},[a._v("#")]),a._v(" 优化数据库")]),a._v(" "),s("ul",[s("li",[a._v("通过数据库乐观锁防止超卖")])]),a._v(" "),s("p",[a._v("update goods_table\nset count = count - 1\nwhere goods_id = xxxx & store > 0")]),a._v(" "),s("h4",{attrs:{id:"优化内存程序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化内存程序"}},[a._v("#")]),a._v(" 优化内存程序")]),a._v(" "),s("p",[a._v("如果库存卖完了，在程序内存里写一个库存是否售完的标记\n如果商品售完，不用请求缓存，直接返回商品已售完；")]),a._v(" "),s("h4",{attrs:{id:"下单失败的情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下单失败的情况"}},[a._v("#")]),a._v(" 下单失败的情况")]),a._v(" "),s("p",[a._v("库存增加，先写数据库，再写缓存，再将商品售完标记置为 false")]),a._v(" "),s("h3",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),s("p",[a._v("用 jmeter 或其他工具模拟并发，进行压测，保证系统质量")]),a._v(" "),s("h2",{attrs:{id:"设计一个缓存系统-lru"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设计一个缓存系统-lru"}},[a._v("#")]),a._v(" 设计一个缓存系统 LRU")]),a._v(" "),s("h3",{attrs:{id:"原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),s("p",[a._v("LRU（Least recently used，最近最少使用）算法根据数据的历史访问记录来进行淘汰数据，\n其核心思想是“如果数据最近被访问过，那么将来被访问的几率也更高”。")]),a._v(" "),s("h3",{attrs:{id:"实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[a._v("#")]),a._v(" 实现")]),a._v(" "),s("p",[a._v("最常见的实现是使用一个链表保存缓存数据，详细算法实现如下：")]),a._v(" "),s("ol",[s("li",[a._v("新数据插入到链表头部；")]),a._v(" "),s("li",[a._v("每当缓存命中（即缓存数据被访问），则将数据移到链表头部；")]),a._v(" "),s("li",[a._v("当链表满的时候，将链表尾部的数据丢弃。")])]),a._v(" "),s("h3",{attrs:{id:"分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分析"}},[a._v("#")]),a._v(" 分析")]),a._v(" "),s("p",[a._v("【命中率】")]),a._v(" "),s("p",[a._v("当存在热点数据时，LRU 的效率很好，但偶发性的、周期性的批量操作会导致 LRU 命中率急剧下降，缓存污染情况比较严重。")]),a._v(" "),s("p",[a._v("【复杂度】")]),a._v(" "),s("p",[a._v("实现简单。")]),a._v(" "),s("p",[a._v("【代价】")]),a._v(" "),s("p",[a._v("命中时需要遍历链表，找到命中的数据块索引，然后需要将数据移到头部。当数据量较大时，遍历链表效率较低。")]),a._v(" "),s("h2",{attrs:{id:"实现-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现-2"}},[a._v("#")]),a._v(" 实现")]),a._v(" "),s("p",[a._v("有一种叫做有序字典的数据结构，综合了哈希表和链表，在 Python 中为 "),s("code",[a._v("OrderedDict")]),a._v(",在 Java 中为 "),s("code",[a._v("LinkedHashMap")]),a._v(",\n在 javascript 中的实现为"),s("code",[a._v("Map")])]),a._v(" "),s("h3",{attrs:{id:"python"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#python"}},[a._v("#")]),a._v(" python")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('from collections import OrderedDict\nclass LRUCache(OrderedDict):\n\n    def __init__(self, capacity):\n        """\n        :type capacity: int\n        """\n        self.capacity = capacity\n\n    def get(self, key):\n        """\n        :type key: int\n        :rtype: int\n        """\n        if key not in self:\n            return - 1\n\n        self.move_to_end(key)\n        return self[key]\n    def put(self, key, value):\n        """\n        :type key: int\n        :type value: int\n        :rtype: void\n        """\n        if key in self:\n            self.move_to_end(key)\n        self[key] = value\n        if len(self) > self.capacity:\n            self.popitem(last = False)\n\n# LRUCache 对象会以如下语句构造和调用:\n# obj = LRUCache(capacity)\n# param_1 = obj.get(key)\n# obj.put(key,value)\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br")])]),s("p",[a._v("复杂度分析")]),a._v(" "),s("ul",[s("li",[a._v("时间复杂度：对于 put 和 get 操作复杂度是 O(1)O(1)，\n因为有序字典中的所有操作：get/in/set/move_to_end/popitem（get/containsKey/put/remove）都可以在常数时间内完成。")]),a._v(" "),s("li",[a._v("空间复杂度：O(capacity)，因为空间只用于有序字典存储最多 capacity + 1 个元素。")])]),a._v(" "),s("h3",{attrs:{id:"java"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java"}},[a._v("#")]),a._v(" java")]),a._v(" "),s("p",[a._v("java 中最简单的 LRU 算法实现，就是利用 jdk 的 LinkedHashMap，覆写其中的 removeEldestEntry(Map.Entry)方法即可")]),a._v(" "),s("p",[a._v("如果你去看 LinkedHashMap 的源码可知，LRU 算法是通过双向链表来实现，当某个位置被命中，通过调整链表的指向将该位置调整到头位置，\n新加入的内容直接放在链表头，如此一来，最近被命中的内容就向链表头移动，需要替换时，链表最后的位置就是最近最少使用的位置。")]),a._v(" "),s("h3",{attrs:{id:"golang"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#golang"}},[a._v("#")]),a._v(" golang")]),a._v(" "),s("p",[a._v("使用双向链表 + collection")]),a._v(" "),s("h3",{attrs:{id:"javascript"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#javascript"}},[a._v("#")]),a._v(" javascript")]),a._v(" "),s("p",[a._v("使用"),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map/keys",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[a._v("javascript ES6 Map 中 keys 的有序性")]),s("OutboundLink")],1),a._v("来实现")]),a._v(" "),s("p",[a._v("一个 Map 对象在迭代时会根据对象中元素的插入顺序来进行")]),a._v(" "),s("ul",[s("li",[a._v("get 操作")])]),a._v(" "),s("p",[a._v("如果元素存在，先 delete 再 set, 元素便会成置为最新使用；如果不存在，返回-1")]),a._v(" "),s("ul",[s("li",[a._v("put 操作")])]),a._v(" "),s("p",[a._v("如果元素存在，先 delete 再 set, 元素便会成置为最新使用；\n如果容器超限，进行删除末尾元素操作，使用 Map{}.keys().next()得到迭代器的第一个元素，为使用时间最远的元素，进行删除")]),a._v(" "),s("div",{staticClass:"language-cpp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * @param {number} capacity\n */")]),a._v("\nvar LRUCache "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("capacity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("capacity "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" capacity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * @param {number} key\n     * @return {number}\n     */")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        let cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        let temp "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("temp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("delete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" temp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" temp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * @param {number} key\n     * @param {number} value\n     * @return {void}\n     */")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        let cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("has")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("delete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("size "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("capacity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("delete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * Your LRUCache object will be instantiated and called as such:\n * var obj = new LRUCache(capacity)\n * var param_1 = obj.get(key)\n * obj.put(key,value)\n */")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br"),s("span",{staticClass:"line-number"},[a._v("47")]),s("br")])]),s("h2",{attrs:{id:"其他更多的-lru-算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他更多的-lru-算法"}},[a._v("#")]),a._v(" 其他更多的 LRU 算法")]),a._v(" "),s("h2",{attrs:{id:"lru-k"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lru-k"}},[a._v("#")]),a._v(" LRU-K")]),a._v(" "),s("h3",{attrs:{id:"原理-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理-2"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),s("p",[a._v("LRU-K 中的 K 代表最近使用的次数，因此 LRU 可以认为是 LRU-1。\nLRU-K 的主要目的是为了解决 LRU 算法“缓存污染”的问题，其核心思想是将“最近使用过 1 次”的判断标准扩展为“最近使用过 K 次”。")]),a._v(" "),s("h3",{attrs:{id:"实现-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现-3"}},[a._v("#")]),a._v(" 实现")]),a._v(" "),s("p",[a._v("相比 LRU，LRU-K 需要多维护一个队列，用于记录所有缓存数据被访问的历史。\n只有当数据的访问次数达到 K 次的时候，才将数据放入缓存。\n当需要淘汰数据时，LRU-K 会淘汰第 K 次访问时间距当前时间最大的数据。详细实现如下：")]),a._v(" "),s("ol",[s("li",[a._v("数据第一次被访问，加入到访问历史列表；")]),a._v(" "),s("li",[a._v("如果数据在访问历史列表里后没有达到 K 次访问，则按照一定规则（FIFO，LRU）淘汰；")]),a._v(" "),s("li",[a._v("当访问历史队列中的数据访问次数达到 K 次后，将数据索引从历史队列删除，将数据移到缓存队列中，并缓存此数据，缓存队列重新按照时间排序；")]),a._v(" "),s("li",[a._v("缓存数据队列中被再次访问后，重新排序；")]),a._v(" "),s("li",[a._v("需要淘汰数据时，淘汰缓存队列中排在末尾的数据，即：淘汰“倒数第 K 次访问离现在最久”的数据。")])]),a._v(" "),s("p",[a._v("LRU-K 具有 LRU 的优点，同时能够避免 LRU 的缺点，实际应用中 LRU-2 是综合各种因素后最优的选择，\nLRU-3 或者更大的 K 值命中率会高，但适应性差，需要大量的数据访问才能将历史访问记录清除掉。")]),a._v(" "),s("h3",{attrs:{id:"分析-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分析-2"}},[a._v("#")]),a._v(" 分析")]),a._v(" "),s("p",[a._v("【命中率】")]),a._v(" "),s("p",[a._v("LRU-K 降低了“缓存污染”带来的问题，命中率比 LRU 要高。")]),a._v(" "),s("p",[a._v("【复杂度】")]),a._v(" "),s("p",[a._v("LRU-K 队列是一个优先级队列，算法复杂度和代价比较高。")]),a._v(" "),s("p",[a._v("【代价】")]),a._v(" "),s("p",[a._v("由于 LRU-K 还需要记录那些被访问过、但还没有放入缓存的对象，因此内存消耗会比 LRU 要多；当数据量很大的时候，内存消耗会比较可观。")]),a._v(" "),s("p",[a._v("LRU-K 需要基于时间进行排序（可以需要淘汰时再排序，也可以即时排序），CPU 消耗比 LRU 要高。")]),a._v(" "),s("h2",{attrs:{id:"two-queues-2q"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#two-queues-2q"}},[a._v("#")]),a._v(" Two queues（2Q）")]),a._v(" "),s("h3",{attrs:{id:"原理-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理-3"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),s("p",[a._v("Two queues（以下使用 2Q 代替）算法类似于 LRU-2，不同点在于 2Q 将 LRU-2 算法中的访问历史队列（注意这不是缓存数据的）改为一个 FIFO 缓存队列，\n即：2Q 算法有两个缓存队列，一个是 FIFO 队列，一个是 LRU 队列。")]),a._v(" "),s("h3",{attrs:{id:"实现-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现-4"}},[a._v("#")]),a._v(" 实现")]),a._v(" "),s("p",[a._v("当数据第一次访问时，2Q 算法将数据缓存在 FIFO 队列里面，当数据第二次被访问时，\n则将数据从 FIFO 队列移到 LRU 队列里面，两个队列各自按照自己的方法淘汰数据。详细实现如下：")]),a._v(" "),s("ol",[s("li",[a._v("新访问的数据插入到 FIFO 队列；")]),a._v(" "),s("li",[a._v("如果数据在 FIFO 队列中一直没有被再次访问，则最终按照 FIFO 规则淘汰；")]),a._v(" "),s("li",[a._v("如果数据在 FIFO 队列中被再次访问，则将数据移到 LRU 队列头部；")]),a._v(" "),s("li",[a._v("如果数据在 LRU 队列再次被访问，则将数据移到 LRU 队列头部；")]),a._v(" "),s("li",[a._v("LRU 队列淘汰末尾的数据。")])]),a._v(" "),s("p",[s("strong",[a._v("注:")]),a._v("\n上图中 FIFO 队列比 LRU 队列短，但并不代表这是算法要求，实际应用中两者比例没有硬性规定。")]),a._v(" "),s("h3",{attrs:{id:"分析-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分析-3"}},[a._v("#")]),a._v(" 分析")]),a._v(" "),s("p",[a._v("【命中率】")]),a._v(" "),s("p",[a._v("2Q 算法的命中率要高于 LRU。")]),a._v(" "),s("p",[a._v("复杂度】")]),a._v(" "),s("p",[a._v("需要两个队列，但两个队列本身都比较简单。")]),a._v(" "),s("p",[a._v("【代价】")]),a._v(" "),s("p",[a._v("FIFO 和 LRU 的代价之和。")]),a._v(" "),s("p",[a._v("2Q 算法和 LRU-2 算法命中率类似，内存消耗也比较接近，但对于最后缓存的数据来说，2Q 会减少一次从原始存储读取数据或者计算数据的操作。")]),a._v(" "),s("h2",{attrs:{id:"multi-queue-mq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#multi-queue-mq"}},[a._v("#")]),a._v(" Multi Queue（MQ）")]),a._v(" "),s("h3",{attrs:{id:"原理-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理-4"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),s("p",[a._v("MQ 算法根据访问频率将数据划分为多个队列，不同的队列具有不同的访问优先级，其核心思想是：优先缓存访问次数多的数据。")]),a._v(" "),s("h3",{attrs:{id:"实现-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现-5"}},[a._v("#")]),a._v(" 实现")]),a._v(" "),s("p",[a._v("MQ 算法将缓存划分为多个 LRU 队列，每个队列对应不同的访问优先级。访问优先级是根据访问次数计算出来的，例如")]),a._v(" "),s("p",[a._v("详细的算法结构图如下，Q0，Q1....Qk 代表不同的优先级队列，Q-history 代表从缓存中淘汰数据，但记录了数据的索引和引用次数的队列：")]),a._v(" "),s("p",[a._v("如上图，算法详细描述如下：")]),a._v(" "),s("ol",[s("li",[a._v("新插入的数据放入 Q0；")]),a._v(" "),s("li",[a._v("每个队列按照 LRU 管理数据；")]),a._v(" "),s("li",[a._v("当数据的访问次数达到一定次数，需要提升优先级时，将数据从当前队列删除，加入到高一级队列的头部；")]),a._v(" "),s("li",[a._v("为了防止高优先级数据永远不被淘汰，当数据在指定的时间里访问没有被访问时，需要降低优先级，将数据从当前队列删除，加入到低一级的队列头部；")]),a._v(" "),s("li",[a._v("需要淘汰数据时，从最低一级队列开始按照 LRU 淘汰；每个队列淘汰数据时，将数据从缓存中删除，将数据索引加入 Q-history 头部；")]),a._v(" "),s("li",[a._v("如果数据在 Q-history 中被重新访问，则重新计算其优先级，移到目标队列的头部；")]),a._v(" "),s("li",[a._v("Q-history 按照 LRU 淘汰数据的索引。")])]),a._v(" "),s("h3",{attrs:{id:"分析-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分析-4"}},[a._v("#")]),a._v(" 分析")]),a._v(" "),s("p",[a._v("【命中率】")]),a._v(" "),s("p",[a._v("MQ 降低了“缓存污染”带来的问题，命中率比 LRU 要高。")]),a._v(" "),s("p",[a._v("【复杂度】")]),a._v(" "),s("p",[a._v("MQ 需要维护多个队列，且需要维护每个数据的访问时间，复杂度比 LRU 高。")]),a._v(" "),s("p",[a._v("【代价】")]),a._v(" "),s("p",[a._v("MQ 需要记录每个数据的访问时间，需要定时扫描所有队列，代价比 LRU 要高。")]),a._v(" "),s("p",[a._v("注：虽然 MQ 的队列看起来数量比较多，但由于所有队列之和受限于缓存容量的大小，因此这里多个队列长度之和和一个 LRU 队列是一样的，因此队列扫描性能也相近。")]),a._v(" "),s("h2",{attrs:{id:"lru-类算法对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lru-类算法对比"}},[a._v("#")]),a._v(" LRU 类算法对比")]),a._v(" "),s("p",[a._v("由于不同的访问模型导致命中率变化较大，此处对比仅基于理论定性分析，不做定量分析。")]),a._v(" "),s("p",[a._v("对比")]),a._v(" "),s("ul",[s("li",[a._v("命中率 LRU-2 > MQ(2) > 2Q > LRU")]),a._v(" "),s("li",[a._v("复杂度 LRU-2 > MQ(2) > 2Q > LRU")])])])}),[],!1,null,null,null);s.default=e.exports}}]);