(window.webpackJsonp=window.webpackJsonp||[]).push([[171],{445:function(a,t,v){"use strict";v.r(t);var s=v(14),_=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"jvm-问题如何排查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm-问题如何排查"}},[a._v("#")]),a._v(" "),t("strong",[a._v("JVM 问题如何排查?")])]),a._v(" "),t("h3",{attrs:{id:"已经发生oom-out-of-memory-排查步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#已经发生oom-out-of-memory-排查步骤"}},[a._v("#")]),a._v(" 已经发生"),t("code",[a._v("OOM（out of memory）")]),a._v("，排查步骤")]),a._v(" "),t("h4",{attrs:{id:"_1-查看当前进程信息-如-使用-arthas-linux-等系统命令如-top-free-等"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-查看当前进程信息-如-使用-arthas-linux-等系统命令如-top-free-等"}},[a._v("#")]),a._v(" 1. 查看当前进程信息，如 使用 arthas，linux 等系统命令如 top，free 等")]),a._v(" "),t("p",[a._v("arthas 是一款 生产环境在线调优、分析、诊断工具")]),a._v(" "),t("h4",{attrs:{id:"_2-生成-dump-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-生成-dump-文件"}},[a._v("#")]),a._v(" 2. 生成 dump 文件")]),a._v(" "),t("p",[a._v("⼀般⽣产系统中都会设置当系统发⽣了 OOM 时，⽣成当时的 dump ⽂件")]),a._v(" "),t("p",[a._v("生产系统 提前配置 jvm 参数，参考如下：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("-XX:+PrintGCDetails\n-XX:+UseConcMarkSweepGC\n-Xmx20m\n-Xms20m\n-XX:+HeapDumpOnOutOfMemoryError (最重要)\n-XX:+HeapDumpBeforeFullGC\n-XX:+HeapDumpAfterFullGC\n-XX:HeapDumpPath=/tmp/gc\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br")])]),t("p",[a._v("也可以使用 arthas 直接生成")]),a._v(" "),t("h4",{attrs:{id:"_3-利用-mat-工具对-dump-日志进行分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-利用-mat-工具对-dump-日志进行分析"}},[a._v("#")]),a._v(" 3. 利用 MAT 工具对 dump 日志进行分析")]),a._v(" "),t("p",[a._v("分析思路或方法论：")]),a._v(" "),t("ol",[t("li",[a._v("定位 占用内存过大的对象 - MAT 中使用 histogram（直方图）倒序查看占用内存较高的对象")]),a._v(" "),t("li",[a._v("这个对象被谁引用 - MAT 中使用 dominator tree（支配节点树）分析对象的调用链")]),a._v(" "),t("li",[a._v("定位到具体代码 - MAT 中的 thread_overview(线程简介图)，里面有方法的调用链信息和堆栈信息。")])]),a._v(" "),t("h3",{attrs:{id:"正常运行的系统-频繁-fullgc-的情况下如何-jvm-调优"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#正常运行的系统-频繁-fullgc-的情况下如何-jvm-调优"}},[a._v("#")]),a._v(" 正常运行的系统（频繁 FullGC 的情况下如何 JVM 调优）")]),a._v(" "),t("ul",[t("li",[a._v("可以使⽤"),t("code",[a._v("jmap")]),a._v("来查看 JVM 中各个区域的使⽤情况")]),a._v(" "),t("li",[a._v("可以通过"),t("code",[a._v("jstack")]),a._v("来查看线程的运⾏情况，⽐如哪些线程阻塞、 是否出现了死锁")]),a._v(" "),t("li",[a._v("可以通过"),t("code",[a._v("jstat")]),a._v("命令来查看垃圾回收的情况，特别是 fullgc，如果发现 fullgc ⽐较频繁，那么就得进⾏调优了")]),a._v(" "),t("li",[a._v("通过各个命令的结果，或者"),t("code",[a._v("jvisualvm")]),a._v("等⼯具来进⾏分析")]),a._v(" "),t("li",[a._v("⾸先，初步猜测频繁发送"),t("code",[a._v("fullgc")]),a._v("的原因，如果频繁发⽣ fullgc 但是⼜⼀直没有出现内存溢出，那么表示 fullgc 实际上是回收了很多对象了，所以这些对象最好能在 younggc 过程中就直接回收掉，避免这些对 象进⼊到⽼年代，对于这种情况，就要考虑这些存活时间不⻓的对象是不是⽐较⼤，导致年轻代放不 下，直接进⼊到了⽼年代，尝试加⼤年轻代的⼤⼩，如果改完之后，fullgc 减少，则证明修改有效")]),a._v(" "),t("li",[a._v("同时，还可以找到占⽤"),t("code",[a._v("CPU最多的线程")]),a._v("，定位到具体的⽅法，优化这个⽅法的执⾏，看是否能避免某些 对象的创建，从⽽节省内存")])]),a._v(" "),t("h2",{attrs:{id:"oom-出现的原因"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#oom-出现的原因"}},[a._v("#")]),a._v(" "),t("strong",[a._v("OOM 出现的原因")])]),a._v(" "),t("p",[a._v("OOM 发生在堆区、元数据区、栈")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("开发人员自身代码出现 OOM 一般有如下几种情况：")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("请求链接阻塞超时")])]),a._v(" "),t("li",[t("p",[a._v("内存泄露；连接没有释放; oss, 数据库，http 请求")])]),a._v(" "),t("li",[t("p",[a._v("超大对象：缓存对象 大 map")])]),a._v(" "),t("li",[t("p",[a._v("超预期的流量：通常是上游系统请求流量飙升，常见于各类促销/秒杀活动，可以结合业务流量指标排查是否有尖状峰值。")])])])]),a._v(" "),t("li",[t("p",[a._v("第三方中间件引入：")]),a._v(" "),t("ul",[t("li",[a._v("比如 当请求过来时， Tomcat 每个线程会创建 两个 4M 大小的缓冲区，高并发场景会 OOM")])])])]),a._v(" "),t("h2",{attrs:{id:"oom-这类生产问题的解决思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#oom-这类生产问题的解决思路"}},[a._v("#")]),a._v(" "),t("strong",[a._v("OOM 这类生产问题的解决思路")])]),a._v(" "),t("h3",{attrs:{id:"通用生产问题解决思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通用生产问题解决思路"}},[a._v("#")]),a._v(" 通用生产问题解决思路")]),a._v(" "),t("p",[a._v("**发生前：**做好监控，及时发现问题")]),a._v(" "),t("p",[t("strong",[a._v("出问题")]),a._v("：尽快恢复，避免对用户产生印象")]),a._v(" "),t("p",[a._v("**复盘：**今后如何避免")]),a._v(" "),t("p",[a._v("1.发生事故不能慌、稳定、沉着、冷静、")]),a._v(" "),t("p",[a._v("2.作为领导不要责怪任何人")])])}),[],!1,null,null,null);t.default=_.exports}}]);