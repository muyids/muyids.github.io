(window.webpackJsonp=window.webpackJsonp||[]).push([[265],{539:function(s,a,e){"use strict";e.r(a);var t=e(14),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("h3",{attrs:{id:"启动和关闭"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动和关闭"}},[s._v("#")]),s._v(" 启动和关闭")]),s._v(" "),a("ul",[a("li",[s._v("启动")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ mongod -f /etc/mongod.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("使用配置文件启动，启动参数详情看配置文件")]),s._v(" "),a("ul",[a("li",[s._v("停止服务")])]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use admin\nswitched to db admin\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.shutdownServer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nserver should be down"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("关闭客户端")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ exit\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接"}},[s._v("#")]),s._v(" 连接")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ mongo --help\n$ mongo --host xxx:3717 --authenticationDatabase admin -u root -p\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"db"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#db"}},[s._v("#")]),s._v(" db")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("查看")]),s._v(" "),a("p",[s._v("show dbs")])]),s._v(" "),a("li",[a("p",[s._v("选择\nuse test_db")])]),s._v(" "),a("li",[a("p",[s._v("查看当前数据库中的所有集合")]),s._v(" "),a("p",[s._v("show collections")])]),s._v(" "),a("li",[a("p",[s._v("查看当前数据库")]),s._v(" "),a("p",[s._v("show db")])]),s._v(" "),a("li",[a("p",[s._v("删除数据库\nuse mydb;\ndb.dropDatabase();")])]),s._v(" "),a("li",[a("p",[s._v("重命名 db")]),s._v(" "),a("ul",[a("li",[s._v("无 rename 操作\n进行如下操作，修改 dbname")])]),s._v(" "),a("ol",[a("li",[s._v('db.copyDatabase("db_to_rename", "db_renamed", "localhost")')]),s._v(" "),a("li",[s._v("use db_to_rename")]),s._v(" "),a("li",[s._v("db.dropDatabase();")])])])]),s._v(" "),a("h3",{attrs:{id:"创建用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建用户"}},[s._v("#")]),s._v(" 创建用户")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('\tdb.createUser(\n\t    {\n\t      user: "dongwei",\n\t      pwd: "test123",\n\t      customData: { sex : "boy"},\n\t      roles: [\n\t         { role: "readWrite", db: "nut_log" }\n\t      ]\n\t    }\n\t)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合"}},[s._v("#")]),s._v(" 集合")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("db、collection 名字规则")]),s._v(" "),a("ul",[a("li",[s._v("必须以下划线和字母开头")]),s._v(" "),a("li",[s._v("不能包含‘$’")]),s._v(" "),a("li",[s._v("不能是空串")]),s._v(" "),a("li",[s._v("不能包含空字符")]),s._v(" "),a("li",[s._v("不能以“system.”开头")]),s._v(" "),a("li",[s._v("貌似也不能包含‘-’")])])]),s._v(" "),a("li",[a("p",[s._v("新建")]),s._v(" "),a("blockquote",[a("p",[s._v('db.createCollection("log_event")')])])]),s._v(" "),a("li",[a("p",[s._v("删除集合")]),s._v(" "),a("blockquote",[a("p",[s._v("db.blog.drop()")])])]),s._v(" "),a("li",[a("p",[s._v("重命名")]),s._v(" "),a("blockquote",[a("p",[s._v('db.blog.renameCollection("Blog")')])])]),s._v(" "),a("li",[a("p",[s._v("删除所有数据")]),s._v(" "),a("blockquote",[a("p",[s._v("db.blog.remove()")])])])]),s._v(" "),a("h3",{attrs:{id:"insert"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#insert"}},[s._v("#")]),s._v(" insert")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("db.blog.insert({文档})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"remove"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#remove"}},[s._v("#")]),s._v(" remove")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("db.blog.remove({条件})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"update"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#update"}},[s._v("#")]),s._v(" update")]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("db.collection.update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("criteria, objNew, upsert, multi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("criteria : update 的查询条件，类似 sql update 查询内 where 后面的")])]),s._v(" "),a("li",[a("p",[s._v("objNew : update 的对象和一些更新的操作符（如"),a("span",{staticClass:"katex"},[a("span",{staticClass:"katex-mathml"},[a("math",[a("semantics",[a("mrow",[a("mo",{attrs:{separator:"true"}},[s._v(",")])],1),a("annotation",{attrs:{encoding:"application/x-tex"}},[s._v(",")])],1)],1)],1),a("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[a("span",{staticClass:"strut",staticStyle:{height:"0.10556em"}}),a("span",{staticClass:"strut bottom",staticStyle:{height:"0.3em","vertical-align":"-0.19444em"}}),a("span",{staticClass:"base textstyle uncramped"},[a("span",{staticClass:"mpunct"},[s._v(",")])])])]),s._v("inc...）等，也可以理解为 sql update 查询内 set 后面的")])]),s._v(" "),a("li",[a("p",[s._v("upsert : 这个参数的意思是，如果不存在 update 的记录，是否插入 objNew，true 为插入，默认是 false，不插入。")])]),s._v(" "),a("li",[a("p",[s._v("multi : mongodb 默认是 false,只更新找到的第一条记录，如果这个参数为 true,就把按条件查出来多条记录全部更新。\n"),a("strong",[s._v("例子")])])]),s._v(" "),a("li",[a("p",[s._v("为 user 集合中的每一条记录添加一个名为 ex 的字段，并赋值为 vip")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('db.user.update({},{$set:{"ex":"vip"}},false,true)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("删除 user 集合中的 age 字段")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('db.user.update({},{$unset:{"age": ""}},{multi:true})\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"find"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#find"}},[s._v("#")]),s._v(" find")]),s._v(" "),a("ul",[a("li",[s._v("find()指定返回的键")]),s._v(" "),a("li",[s._v("查询条件 $lt $gt $lte $gte")]),s._v(" "),a("li",[s._v("别的查询键 $or $in $nin $not 等")]),s._v(" "),a("li",[s._v("查询数组相关：$all $size $slice")]),s._v(" "),a("li",[s._v("正则表达式：支持 Perl 兼容的正则表达式(PCRE)")]),s._v(" "),a("li",[s._v("对查询结果的处理 $limit $skip sort (其中skip 适合跳过少量文档，否则性能影响)")]),s._v(" "),a("li",[s._v("查询某个字段是否存在 { 字段 : { $exists: true } }")]),s._v(" "),a("li",[s._v("以上不能满足，还有$where，更复杂的查询是 mapreduce(下文介绍)\n聚合(mongodb 本身的聚合操作可能可以好好依赖一下，比如 olap 里复杂的查询和本地聚合操作可以大量借用 mapreduce？)")]),s._v(" "),a("li",[s._v("count() distinct()")]),s._v(" "),a("li",[s._v("group() 类似 group by,且可以附带一个 finalize 函数对结果修剪")]),s._v(" "),a("li",[s._v("mapreduce 可以做复杂的聚合查询，并行化到多个服务器，当然 mapreduce 和 group 都不适合实时场景")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("db.stu.find({ score:{ $gt:90 } },{ name:1}).sort({age: 1}).limit(10)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"skip-语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#skip-语句"}},[s._v("#")]),s._v(" skip()语句")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("db.collection.find().skip(N)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("当 N 比较大的时候，比如大于一千万，效率很低，使用{_id: {$gt: ObjectId}}替代")])]),s._v(" "),a("h3",{attrs:{id:"数组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数组"}},[s._v("#")]),s._v(" 数组")]),s._v(" "),a("h4",{attrs:{id:"增加数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增加数据"}},[s._v("#")]),s._v(" 增加数据")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('db.transfer.update({"_id" : ObjectId("5be95c974f0c47045d7862e9")}, {"$push":{"trade_err": "hello"}}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"删除字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除字段"}},[s._v("#")]),s._v(" 删除字段")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("db.transfer.update({},{$unset:{'trade_err':''}}, false, true)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);