(window.webpackJsonp=window.webpackJsonp||[]).push([[308],{581:function(e,t,v){"use strict";v.r(t);var _=v(14),a=Object(_.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"高效的分布式锁"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#高效的分布式锁"}},[e._v("#")]),e._v(" 高效的分布式锁")]),e._v(" "),t("p",[e._v("考虑几点：")]),e._v(" "),t("ol",[t("li",[e._v("互斥：同一时刻只有一个线程获取到锁")]),e._v(" "),t("li",[e._v("防止死锁：线程获取锁后，系统故障无法释放锁，需要设置锁的过期时间自动释放")]),e._v(" "),t("li",[e._v("性能：减少锁的等待时间\n"),t("ol",[t("li",[e._v("锁的颗粒度尽量小")]),e._v(" "),t("li",[e._v("锁的范围尽量小")])])]),e._v(" "),t("li",[e._v("可重入：同 ReentrantLock：同一个线程可以重复拿到同一个资源的锁")])]),e._v(" "),t("h4",{attrs:{id:"redis-分布式锁的缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-分布式锁的缺点"}},[e._v("#")]),e._v(" Redis 分布式锁的缺点")]),e._v(" "),t("p",[e._v("在哨兵模式或者主从模式下，如果 master 实例宕机的时候，可能导致多个客户端同时完成加锁。")]),e._v(" "),t("h2",{attrs:{id:"setnx-expire"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setnx-expire"}},[e._v("#")]),e._v(" SETNX + EXPIRE")]),e._v(" "),t("p",[t("code",[e._v("SETNX + EXPIRE")]),e._v(" 两条指令结合使用：")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("先拿 setnx 来争抢锁")])]),e._v(" "),t("li",[t("p",[e._v("抢到之后，再用 expire 给锁加一个过期时间防止锁忘记了释放\n存在问题：")])]),e._v(" "),t("li",[t("p",[e._v("两条指令结合使用，不满足事务性；")])]),e._v(" "),t("li",[t("p",[e._v("如果 expire 未成功执行，锁只能主动释放，如果业务代码不成功，锁存在永远得不到释放的情况。")])])]),e._v(" "),t("h2",{attrs:{id:"set-nx-ex"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#set-nx-ex"}},[e._v("#")]),e._v(" SET NX EX")]),e._v(" "),t("p",[e._v("命令 "),t("code",[e._v("SET resource-name anystring NX EX max-lock-time")]),e._v(" 是一种在 Redis 中实现锁的简单方法。")]),e._v(" "),t("p",[e._v("相当于把 "),t("code",[e._v("setnx")]),e._v(" 和 "),t("code",[e._v("expire")]),e._v(" 合成一条指令来用，支持事务性")]),e._v(" "),t("h2",{attrs:{id:"lua-脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lua-脚本"}},[e._v("#")]),e._v(" lua 脚本")]),e._v(" "),t("p",[e._v("使用 lua 脚本的好处:")]),e._v(" "),t("ul",[t("li",[e._v("减少网络开销：本来 5 次网络请求的操作，可以用一个请求完成")]),e._v(" "),t("li",[e._v("原子操作：Redis 会将整个脚本作为一个整体执行，中间不会被其他命令插入")])])])}),[],!1,null,null,null);t.default=a.exports}}]);