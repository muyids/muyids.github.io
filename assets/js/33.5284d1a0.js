(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{307:function(s,n,e){"use strict";e.r(n);var a=e(14),r=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("java 的注解学习")]),s._v(" "),n("p",[s._v("aop 实现 redis 分布式锁，可以通过注解+spel 表达式拼出你的 key，加在方法纬度上就可以了。部门现在确实有这么一个组件，不过我还是比较喜欢自己拿锁手动释放，异常处理逻辑比较清晰。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://muyids.oss-cn-beijing.aliyuncs.com/179981629461259_.pic.jpg",alt:"179981629461259_.pic"}})]),s._v(" "),n("p",[n("img",{attrs:{src:"https://muyids.oss-cn-beijing.aliyuncs.com/180071629462006_.pic.jpg",alt:"180071629462006_.pic"}})]),s._v(" "),n("p",[n("img",{attrs:{src:"https://muyids.oss-cn-beijing.aliyuncs.com/180081629462023_.pic.jpg",alt:"180081629462023_.pic"}})]),s._v(" "),n("p",[s._v("注解")]),s._v(" "),n("ul",[n("li",[s._v("反射机制")])]),s._v(" "),n("p",[s._v("Java 的注解 实战一下")]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("中间件架构")]),s._v(" "),n("p",[s._v("nodejs express 框架中间件架构")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// 路由层\n// 签到功能API\nrouter.post('/daily/sign/accept',\n    signMiddleware.checkTime,\n    middleware.lock('signAccept', 'userId'),\n    middleware.checkAppSign,\n    middleware.checkToken,\n    middleware.checkMacAddress,\n    middleware.midCheckUser(),\n    signMiddleware.getSignInfo, middleware.verifyValidateCode, middleware.todaySignIn,\n    middleware.getUserInfo, middleware.getUserBirthDay,\n    signService.accept)\n\n// 中间件层\nexports.lock = function (prefix, param) {\n    return function (req, res, next) {\n        var key = 'lock-' + prefix + '-' + req.param(param)\n        redisClient.incr(key, function (err, value) {\n            redisClient.EXPIRE(key, 30)\n            console.log('[%j], lockID: %j, value: %j, err: %j', new Date().toLocaleString(), key, value, err)\n            if (err) {\n                return res.send(500, '系统繁忙')\n            }\n            if (value > 1) {\n                return res.send(403, '操作太频繁')\n            }\n            req.lockID = key\n            return next()\n        })\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])])])}),[],!1,null,null,null);n.default=r.exports}}]);