(window.webpackJsonp=window.webpackJsonp||[]).push([[222],{496:function(s,t,a){"use strict";a.r(t);var r=a(14),n=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"spring-config-分布式配置中心"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spring-config-分布式配置中心"}},[s._v("#")]),s._v(" Spring Config 分布式配置中心")]),s._v(" "),t("p",[s._v("==微服务面临的问题==")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("可以看到"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("每个微服务都需要一个配置文件"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("并且"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("如果有几个微服务都需要连接数据库\n\t\t那么就需要配"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("次数据库相关配置"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("并且当数据库发生改动"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("那么需要同时修改"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("个微服务的配置文件才可以\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("所以有了 springconfig 配置中心")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%841.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%842.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%843.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%844.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"使用配置中心"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用配置中心"}},[s._v("#")]),s._v(" 使用配置中心:")]),s._v(" "),t("h4",{attrs:{id:"_0-使用-github-作为配置中心的仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0-使用-github-作为配置中心的仓库"}},[s._v("#")]),s._v(" 0,使用 github 作为配置中心的仓库:")]),s._v(" "),t("p",[t("strong",[s._v("初始化 git 环境:")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%845.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_1-新建-config-模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-新建-config-模块"}},[s._v("#")]),s._v(" 1,新建 config 模块:")]),s._v(" "),t("p",[s._v("名字: cloud-config-3344")]),s._v(" "),t("h4",{attrs:{id:"_2-pom"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-pom"}},[s._v("#")]),s._v(" 2,pom")]),s._v(" "),t("h4",{attrs:{id:"_3-配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置文件"}},[s._v("#")]),s._v(" 3,配置文件")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%846.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_4-主启动类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-主启动类"}},[s._v("#")]),s._v(" 4,主启动类")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%847.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_5-修改-hosts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-修改-hosts"}},[s._v("#")]),s._v(" 5,修改 hosts:")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%848.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_6-配置完成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-配置完成"}},[s._v("#")]),s._v(" 6,配置完成")]),s._v(" "),t("p",[s._v("测试,3344 是否可以从 github 上获取配置")]),s._v(" "),t("p",[s._v("启动 3344 (要先启动 eureka)")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%849.png",alt:""}})]),s._v(" "),t("p",[s._v("它实际上就是,读取到配置文件中的 GitHub 的地址,然后拼接上/master/config-dev.yml")]),s._v(" "),t("h4",{attrs:{id:"_7-读取配置文件的规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-读取配置文件的规则"}},[s._v("#")]),s._v(" 7,读取配置文件的规则:")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8410.png",alt:""}})]),s._v(" "),t("p",[s._v("==2,==")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8411.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("这里默认会读取 master 分支,因为我们配置文件中配置了")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8412.png",alt:""}})]),s._v(" "),t("p",[s._v("==3==")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8413.png",alt:""}})]),s._v(" "),t("p",[s._v("注意,这个方式读取到的配置是==json 格式==的")]),s._v(" "),t("p",[t("strong",[s._v("所有规则:")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8414.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_2-创建配置中心客户端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建配置中心客户端"}},[s._v("#")]),s._v(" 2,创建配置中心客户端:")]),s._v(" "),t("h4",{attrs:{id:"_1-创建-config-客户端项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建-config-客户端项目"}},[s._v("#")]),s._v(" 1,创建 config 客户端项目")]),s._v(" "),t("p",[s._v("名字: cloud-config-client-3355")]),s._v(" "),t("h4",{attrs:{id:"_2-pom-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-pom-2"}},[s._v("#")]),s._v(" 2,pom")]),s._v(" "),t("h4",{attrs:{id:"_3-配置文件-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置文件-2"}},[s._v("#")]),s._v(" 3,配置文件")]),s._v(" "),t("p",[s._v("注意这个配置文件就不是 application.yml")]),s._v(" "),t("p",[s._v("​ 而是 bootstrap.yml")]),s._v(" "),t("p",[s._v("这个配置文件的作用是,先到配置中心加载配置,然后加载到 application.yml 中")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8415.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8416.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_4-主启动类-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-主启动类-2"}},[s._v("#")]),s._v(" 4,主启动类:")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8417.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_5-controller-类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-controller-类"}},[s._v("#")]),s._v(" 5,controller 类")]),s._v(" "),t("p",[s._v("就是上面提到的,以 rest 风格将配置对外暴露")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8418.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8419.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("如果客户端运行正常,就会读取到 github 上配置文件的,config.info 下的配置")])]),s._v(" "),t("h4",{attrs:{id:"_6-测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-测试"}},[s._v("#")]),s._v(" 6,测试:")]),s._v(" "),t("p",[s._v("启动 3344,3355")]),s._v(" "),t("p",[s._v("​ 访问 3355 的 /configInfo")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8421.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_7-问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-问题"}},[s._v("#")]),s._v(" 7,问题::")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("上面"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3355")]),s._v("确实获取到了配置文件"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但是如果此时配置文件修改了"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3355")]),s._v("是获取不到的\n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3344")]),s._v("可以实时获取到最新配置文件"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但是"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3355")]),s._v("却获取不到\n  \t除非重启服务\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"_8-实现动态刷新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-实现动态刷新"}},[s._v("#")]),s._v(" "),t("strong",[s._v("8,实现动态刷新:")])]),s._v(" "),t("h5",{attrs:{id:"_1-修改-3355-添加一个-pom-依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-修改-3355-添加一个-pom-依赖"}},[s._v("#")]),s._v(" 1,修改 3355,添加一个 pom 依赖:")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8422.png",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"_2-修改配置文件-添加一个配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改配置文件-添加一个配置"}},[s._v("#")]),s._v(" 2,修改配置文件,添加一个配置:")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8423.png",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"_3-修改-controller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-修改-controller"}},[s._v("#")]),s._v(" 3,修改 controller:")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8424.png",alt:""}})]),s._v(" "),t("h5",{attrs:{id:"_4-此时重启服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-此时重启服务"}},[s._v("#")]),s._v(" 4,此时重启服务")]),s._v(" "),t("p",[t("strong",[s._v("此时 3355 还不可以动态获取")])]),s._v(" "),t("p",[s._v("因为此时,还需要==外部==发送 post 请求通知 3355")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://fltrp-dera.oss-cn-hangzhou.aliyuncs.com/spring-cloud/pic/springconfig%E7%9A%8425.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("此时在刷新 3355,发现可以获取到最新的配置文件了,这就实现了动态获取配置文件,因为 3355 并没有重启")])]),s._v(" "),t("p",[s._v("具体流程就是:")]),s._v(" "),t("p",[s._v("​ 我们启动好服务后")]),s._v(" "),t("p",[s._v("​ 运维人员,修改了配置文件,然后发送一个 post 请求通知 3355")])])}),[],!1,null,null,null);t.default=n.exports}}]);